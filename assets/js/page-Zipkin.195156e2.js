(window.webpackJsonp=window.webpackJsonp||[]).push([[102],{1113:function(e,t,a){"use strict";a.r(t);var s=a(1),r=Object(s.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"zipkin-server"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#zipkin-server"}},[e._v("#")]),e._v(" zipkin-server")]),e._v(" "),a("p",[e._v("Zipkin Server is a Java 1.8+ service, packaged as an executable jar.")]),e._v(" "),a("p",[e._v("Span storage and collectors are "),a("a",{attrs:{href:"#configuration"}},[e._v("configurable")]),e._v(". By default, storage is in-memory,\nthe HTTP collector (POST /api/v2/spans endpoint) is enabled, and the server listens on port 9411.")]),e._v(" "),a("p",[e._v("Zipkin Server is implemented with "),a("a",{attrs:{href:"https://github.com/line/armeria",target:"_blank",rel:"noopener noreferrer"}},[e._v("Armeria"),a("OutboundLink")],1),e._v(". While it uses "),a("a",{attrs:{href:"http://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Spring Boot"),a("OutboundLink")],1),e._v("\ninternally, Zipkin Server should not be considered a normal Spring Boot application.")]),e._v(" "),a("h2",{attrs:{id:"custom-servers-are-not-supported"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#custom-servers-are-not-supported"}},[e._v("#")]),e._v(" Custom servers are not supported")]),e._v(" "),a("p",[e._v("By Custom servers we mean trying to use/embed "),a("code",[e._v("zipkin")]),e._v(" as part of "),a("em",[e._v("an application you package")]),e._v(" (e.g. adding "),a("code",[e._v("zipkin-server")]),e._v(" dependency to a Spring-boot application) instead of the packaged application we release.")]),e._v(" "),a("p",[e._v("For proper usage, see the guides below.")]),e._v(" "),a("h2",{attrs:{id:"quick-start"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#quick-start"}},[e._v("#")]),e._v(" Quick-start")]),e._v(" "),a("p",[e._v("The quickest way to get started is to fetch the "),a("a",{attrs:{href:"https://search.maven.org/remote_content?g=io.zipkin&a=zipkin-server&v=LATEST&c=exec",target:"_blank",rel:"noopener noreferrer"}},[e._v("latest released server"),a("OutboundLink")],1),e._v(" as a self-contained executable jar. Note that the Zipkin server requires minimum JRE 8. For example:")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("curl")]),e._v(" -sSL https://zipkin.io/quickstart.sh "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("bash")]),e._v(" -s\n$ java -jar zipkin.jar\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("p",[e._v("Once you've started, browse to http://your_host:9411 to find traces!")]),e._v(" "),a("h2",{attrs:{id:"endpoints"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#endpoints"}},[e._v("#")]),e._v(" Endpoints")]),e._v(" "),a("p",[e._v("The following endpoints are defined under the base url http://your_host:9411")]),e._v(" "),a("ul",[a("li",[e._v("/ - "),a("a",{attrs:{href:"../zipkin-ui"}},[e._v("UI")])]),e._v(" "),a("li",[e._v("/config.json - "),a("a",{attrs:{href:"#configuration-for-the-ui"}},[e._v("Configuration for the UI")])]),e._v(" "),a("li",[e._v("/api/v2 - "),a("a",{attrs:{href:"https://zipkin.io/zipkin-api/#/",target:"_blank",rel:"noopener noreferrer"}},[e._v("API"),a("OutboundLink")],1)]),e._v(" "),a("li",[e._v("/health - Returns 200 status if OK")]),e._v(" "),a("li",[e._v("/info - Provides the version of the running instance")]),e._v(" "),a("li",[e._v("/metrics - Includes collector metrics broken down by transport type")]),e._v(" "),a("li",[e._v("/prometheus - Prometheus scrape endpoint")])]),e._v(" "),a("p",[e._v("The "),a("a",{attrs:{href:"https://zipkin.io/zipkin-api/#/",target:"_blank",rel:"noopener noreferrer"}},[e._v("legacy /api/v1 API"),a("OutboundLink")],1),e._v(" is still supported. Backends are decoupled from the\nHTTP API via data conversion. This means you can still accept legacy data on new backends and visa versa. Enter\n"),a("code",[e._v("https://zipkin.io/zipkin-api/zipkin-api.yaml")]),e._v(" into the explore box of the Swagger UI to view the old definition")]),e._v(" "),a("h3",{attrs:{id:"cors-cross-origin-resource-sharing"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cors-cross-origin-resource-sharing"}},[e._v("#")]),e._v(" CORS (Cross-origin Resource Sharing)")]),e._v(" "),a("p",[e._v("By default, all endpoints under "),a("code",[e._v("/api/v2")]),e._v(" are configured to "),a("strong",[e._v("allow")]),e._v(" cross-origin requests.")]),e._v(" "),a("p",[e._v("This can be changed by modifying the property "),a("code",[e._v("zipkin.query.allowed-origins")]),e._v(".")]),e._v(" "),a("p",[e._v("For example, to allow CORS requests from "),a("code",[e._v("http://foo.bar.com")]),e._v(":")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("ZIPKIN_QUERY_ALLOWED_ORIGINS=http://foo.bar.com\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("See "),a("a",{attrs:{href:"#configuration"}},[e._v("Configuration")]),e._v(" for more about how Zipkin is configured.")]),e._v(" "),a("h3",{attrs:{id:"service-and-span-names-query"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#service-and-span-names-query"}},[e._v("#")]),e._v(" Service and Span names query")]),e._v(" "),a("p",[e._v("The "),a("a",{attrs:{href:"https://zipkin.io/zipkin-api/#/default/get_services",target:"_blank",rel:"noopener noreferrer"}},[e._v("Zipkin API"),a("OutboundLink")],1),e._v(" does not include\na parameter for how far back to look for service or span names. In order\nto prevent excessive load, service and span name queries are limited by\n"),a("code",[e._v("QUERY_LOOKBACK")]),e._v(", which defaults to 24hrs (two daily buckets: one for\ntoday and one for yesterday)")]),e._v(" "),a("h2",{attrs:{id:"logging"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#logging"}},[e._v("#")]),e._v(" Logging")]),e._v(" "),a("p",[e._v("By default, zipkin writes log messages to the console at INFO level and above. You can adjust\ncategories using the "),a("code",[e._v("logging.level.XXX")]),e._v(" property.")]),e._v(" "),a("p",[e._v("For example, if you want to enable debug logging for all zipkin categories, you can start the server like so:")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ java -jar zipkin.jar --logging.level.zipkin2"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("DEBUG\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("See "),a("a",{attrs:{href:"#configuration"}},[e._v("Configuration")]),e._v(" for more about how Zipkin is configured.")]),e._v(" "),a("h3",{attrs:{id:"advanced-logging-configuration"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#advanced-logging-configuration"}},[e._v("#")]),e._v(" Advanced Logging Configuration")]),e._v(" "),a("p",[e._v("Under the covers, the server uses "),a("a",{attrs:{href:"http://docs.spring.io/spring-boot/docs/current/reference/html/howto-logging.html#howto-configure-logback-for-logging",target:"_blank",rel:"noopener noreferrer"}},[e._v("Spring Boot - Logback integration"),a("OutboundLink")],1),e._v(".\nFor example, you can add "),a("code",[e._v("--logging.exception-conversion-word=%wEx{full}")]),e._v(" to dump full stack traces\ninstead of truncated ones.")]),e._v(" "),a("h2",{attrs:{id:"metrics"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#metrics"}},[e._v("#")]),e._v(" Metrics")]),e._v(" "),a("p",[e._v("Collector Metrics are exported to the path "),a("code",[e._v("/metrics")]),e._v(". These and additional metrics are exported\nto the path "),a("code",[e._v("/prometheus")]),e._v(".")]),e._v(" "),a("h3",{attrs:{id:"example-prometheus-configuration"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#example-prometheus-configuration"}},[e._v("#")]),e._v(" Example Prometheus configuration")]),e._v(" "),a("p",[e._v("Here's an example "),a("code",[e._v("/prometheus")]),e._v(" configuration, using the Prometheus\nexposition "),a("a",{attrs:{href:"https://prometheus.io/docs/instrumenting/exposition_formats/",target:"_blank",rel:"noopener noreferrer"}},[e._v("text format version 0.0.4"),a("OutboundLink")],1)]),e._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[e._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("job_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'zipkin'")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("scrape_interval")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" 5s\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("metrics_path")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'/prometheus'")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("static_configs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("targets")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'localhost:9411'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("metric_relabel_configs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Response code count")]),e._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("source_labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("__name__"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("regex")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'^status_(\\d+)_(.*)$'")]),e._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("replacement")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'${1}'")]),e._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("target_label")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" status\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("source_labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("__name__"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("regex")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'^status_(\\d+)_(.*)$'")]),e._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("replacement")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'${2}'")]),e._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("target_label")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" path\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("source_labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("__name__"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("regex")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'^status_(\\d+)_(.*)$'")]),e._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("replacement")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'http_requests_total'")]),e._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("target_label")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" __name__\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br"),a("span",{staticClass:"line-number"},[e._v("14")]),a("br"),a("span",{staticClass:"line-number"},[e._v("15")]),a("br"),a("span",{staticClass:"line-number"},[e._v("16")]),a("br"),a("span",{staticClass:"line-number"},[e._v("17")]),a("br"),a("span",{staticClass:"line-number"},[e._v("18")]),a("br"),a("span",{staticClass:"line-number"},[e._v("19")]),a("br")])]),a("h3",{attrs:{id:"collector"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#collector"}},[e._v("#")]),e._v(" Collector")]),e._v(" "),a("p",[e._v('Collector metrics are broken down by transport. The following are exported to the "/metrics" endpoint:')]),e._v(" "),a("table",[a("thead",[a("tr",[a("th",[e._v("Metric")]),e._v(" "),a("th",[e._v("Description")])])]),e._v(" "),a("tbody",[a("tr",[a("td",[e._v("counter.zipkin_collector.messages.$transport")]),e._v(" "),a("td",[e._v("cumulative messages received; should relate to messages reported by instrumented apps")])]),e._v(" "),a("tr",[a("td",[e._v("counter.zipkin_collector.messages_dropped.$transport")]),e._v(" "),a("td",[e._v("cumulative messages dropped; reasons include client disconnects or malformed content")])]),e._v(" "),a("tr",[a("td",[e._v("counter.zipkin_collector.bytes.$transport")]),e._v(" "),a("td",[e._v("cumulative message bytes")])]),e._v(" "),a("tr",[a("td",[e._v("counter.zipkin_collector.spans.$transport")]),e._v(" "),a("td",[e._v("cumulative spans read; should relate to messages reported by instrumented apps")])]),e._v(" "),a("tr",[a("td",[e._v("counter.zipkin_collector.spans_dropped.$transport")]),e._v(" "),a("td",[e._v("cumulative spans dropped; reasons include sampling or storage failures")])]),e._v(" "),a("tr",[a("td",[e._v("gauge.zipkin_collector.message_spans.$transport")]),e._v(" "),a("td",[e._v("last count of spans in a message")])]),e._v(" "),a("tr",[a("td",[e._v("gauge.zipkin_collector.message_bytes.$transport")]),e._v(" "),a("td",[e._v("last count of bytes in a message")])])])]),e._v(" "),a("h2",{attrs:{id:"configuration"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#configuration"}},[e._v("#")]),e._v(" Configuration")]),e._v(" "),a("p",[e._v("We support ENV variable configuration, such as "),a("code",[e._v("STORAGE_TYPE=cassandra3")]),e._v(", as they are familiar to\nadministrators and easy to use in runtime environments such as Docker.")]),e._v(" "),a("p",[e._v("Here are the top-level configuration of Zipkin:")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("QUERY_PORT")]),e._v(": Listen port for the HTTP API and web UI; Defaults to 9411")]),e._v(" "),a("li",[a("code",[e._v("QUERY_ENABLED")]),e._v(": "),a("code",[e._v("false")]),e._v(" disables the HTTP read endpoints under '/api/v2'. This also disables the\nUI, as it relies on the API. If your only goal is to restrict search, use "),a("code",[e._v("SEARCH_ENABLED")]),e._v(" instead.\nDefaults to true")]),e._v(" "),a("li",[a("code",[e._v("SEARCH_ENABLED")]),e._v(": "),a("code",[e._v("false")]),e._v(" disables searching in the query API and any indexing or post-processing\nin the collector to support search. This does not disable the entire UI, as trace by ID and\ndependency queries still operate. Disable this when you use another service (such as logs) to find\ntrace IDs. Defaults to true")]),e._v(" "),a("li",[a("code",[e._v("QUERY_TIMEOUT")]),e._v(": Sets the hard timeout for query requests. Accepts any duration string (e.g., 100ms).\nA value of 0 will disable the timeout completely. Defaults to 11s.")]),e._v(" "),a("li",[a("code",[e._v("QUERY_LOG_LEVEL")]),e._v(": Log level written to the console; Defaults to INFO")]),e._v(" "),a("li",[a("code",[e._v("QUERY_NAMES_MAX_AGE")]),e._v(": Controls the value of the "),a("code",[e._v("max-age")]),e._v(" header zipkin-server responds with on\nhttp requests for autocompleted values in the UI (service names for example). Defaults to 300 seconds.")]),e._v(" "),a("li",[a("code",[e._v("QUERY_LOOKBACK")]),e._v(": How many milliseconds queries can look back from endTs; Defaults to 24 hours (two daily buckets: one for today and one for yesterday)")]),e._v(" "),a("li",[a("code",[e._v("STORAGE_TYPE")]),e._v(": SpanStore implementation: one of "),a("code",[e._v("mem")]),e._v(", "),a("code",[e._v("mysql")]),e._v(", "),a("code",[e._v("cassandra3")]),e._v(", "),a("code",[e._v("elasticsearch")])]),e._v(" "),a("li",[a("code",[e._v("COLLECTOR_SAMPLE_RATE")]),e._v(": Percentage of traces to retain, defaults to always sample (1.0).")]),e._v(" "),a("li",[a("code",[e._v("AUTOCOMPLETE_KEYS")]),e._v(": list of span tag keys which will be returned by the "),a("code",[e._v("/api/v2/autocompleteTags")]),e._v(' endpoint; Tag keys should be comma separated e.g. "instance_id,user_id,env"')]),e._v(" "),a("li",[a("code",[e._v("AUTOCOMPLETE_TTL")]),e._v(": How long in milliseconds to suppress calls to write the same autocomplete key/value pair. Default 3600000 (1 hr)")])]),e._v(" "),a("h3",{attrs:{id:"configuration-file-overrides"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#configuration-file-overrides"}},[e._v("#")]),e._v(" Configuration file overrides")]),e._v(" "),a("p",[e._v("Under the scenes, all configuration are managed by Spring Boot. This means that properties may also\nbe overridden by system properties or any other alternative "),a("a",{attrs:{href:"https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-external-config.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("supported by Spring Boot"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("p",[e._v("We use "),a("a",{attrs:{href:"src/main/resources/zipkin-server-shared.yml"}},[e._v("yaml configuration")]),e._v(" to bind shorter or more\nidiomatic ENV variables to the Spring properties ultimately in use. While most users should only use\nenvironment variables, some may desire a properties file approach to override settings. For example,\nknowing we set "),a("code",[e._v("spring.config.name=zipkin-server")]),e._v(", Spring Boot will automatically look for a file\nnamed "),a("code",[e._v("zipkin-server.properties")]),e._v(" in the current directory, and the same properties we set in yaml\ncan be overridden that way.")]),e._v(" "),a("p",[e._v("If you choose to use property-based configuration instead of ENV variables, you are choosing to\nself-support your configuration. This means you'll use "),a("a",{attrs:{href:"https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-external-config.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Spring Boot documentation"),a("OutboundLink")],1),e._v("\nor "),a("a",{attrs:{href:"https://stackoverflow.com/questions/tagged/spring-boot",target:"_blank",rel:"noopener noreferrer"}},[e._v("StackOverflow"),a("OutboundLink")],1),e._v(" to resolve concerns\nrelated to property resolution as opposed to raising issues or using our chat support. We have to\nmention this because configuration of Spring implies vast responsibility and our resources must be\nconserved for Zipkin related tasks.")]),e._v(" "),a("h2",{attrs:{id:"ui"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ui"}},[e._v("#")]),e._v(" UI")]),e._v(" "),a("p",[e._v("Zipkin has a web UI, automatically included in the exec jar, and is hosted by default on port 9411.")]),e._v(" "),a("p",[e._v("When the UI loads, it reads default configuration from the "),a("code",[e._v("/config.json")]),e._v(" endpoint.")]),e._v(" "),a("table",[a("thead",[a("tr",[a("th",[e._v("Attribute")]),e._v(" "),a("th",[e._v("Property")]),e._v(" "),a("th",[e._v("Description")])])]),e._v(" "),a("tbody",[a("tr",[a("td",[e._v("environment")]),e._v(" "),a("td",[e._v("zipkin.ui.environment")]),e._v(" "),a("td",[e._v("The value here becomes a label in the top-right corner. Not required.")])]),e._v(" "),a("tr",[a("td",[e._v("defaultLookback")]),e._v(" "),a("td",[e._v("zipkin.ui.default-lookback")]),e._v(" "),a("td",[e._v('Default duration in millis to look back when finding traces. Affects the "Start time" element in the UI. Defaults to 900000 (15 minutes in millis).')])]),e._v(" "),a("tr",[a("td",[e._v("searchEnabled")]),e._v(" "),a("td",[e._v("zipkin.ui.search-enabled")]),e._v(" "),a("td",[e._v("If the Discover screen is enabled. Defaults to true.")])]),e._v(" "),a("tr",[a("td",[e._v("queryLimit")]),e._v(" "),a("td",[e._v("zipkin.ui.query-limit")]),e._v(" "),a("td",[e._v("Default limit for Find Traces. Defaults to 10.")])]),e._v(" "),a("tr",[a("td",[e._v("instrumented")]),e._v(" "),a("td",[e._v("zipkin.ui.instrumented")]),e._v(" "),a("td",[e._v("Which sites this Zipkin UI covers. Regex syntax. e.g. "),a("code",[e._v("http:\\/\\/example.com\\/.*")]),e._v(" Defaults to match all websites ("),a("code",[e._v(".*")]),e._v(").")])]),e._v(" "),a("tr",[a("td",[e._v("logsUrl")]),e._v(" "),a("td",[e._v("zipkin.ui.logs-url")]),e._v(" "),a("td",[e._v("Logs query service url pattern. If specified, a button will appear on the trace page and will replace {traceId} in the url by the traceId. Not required.")])]),e._v(" "),a("tr",[a("td",[e._v("supportUrl")]),e._v(" "),a("td",[e._v("zipkin.ui.support-url")]),e._v(" "),a("td",[e._v("A URL where a user can ask for support. If specified, a link will be placed in the side menu to this URL, for example a page to file support tickets. Not required.")])]),e._v(" "),a("tr",[a("td",[e._v("archivePostUrl")]),e._v(" "),a("td",[e._v("zipkin.ui.archive-post-url")]),e._v(" "),a("td",[e._v("Url to POST the current trace in Zipkin v2 json format. e.g. 'https://longterm/api/v2/spans'. If specified, a button will appear on the trace page accordingly. Not required.")])]),e._v(" "),a("tr",[a("td",[e._v("archiveUrl")]),e._v(" "),a("td",[e._v("zipkin.ui.archive-url")]),e._v(" "),a("td",[e._v("Url to a web application serving an archived trace, templated by '{traceId}'. e.g. https://longterm/zipkin/trace/{traceId}'. This is shown in a confirmation message after a trace is successfully POSTed to the "),a("code",[e._v("archivePostUrl")]),e._v(". Not required.")])]),e._v(" "),a("tr",[a("td",[e._v("dependency.enabled")]),e._v(" "),a("td",[e._v("zipkin.ui.dependency.enabled")]),e._v(" "),a("td",[e._v("If the Dependencies screen is enabled. Defaults to true.")])]),e._v(" "),a("tr",[a("td",[e._v("dependency.lowErrorRate")]),e._v(" "),a("td",[e._v("zipkin.ui.dependency.low-error-rate")]),e._v(" "),a("td",[e._v("The rate of error calls on a dependency link that turns it yellow. Defaults to 0.5 (50%) set to >1 to disable.")])]),e._v(" "),a("tr",[a("td",[e._v("dependency.highErrorRate")]),e._v(" "),a("td",[e._v("zipkin.ui.dependency.high-error-rate")]),e._v(" "),a("td",[e._v("The rate of error calls on a dependency link that turns it red. Defaults to 0.75 (75%) set to >1 to disable.")])]),e._v(" "),a("tr",[a("td",[e._v("basePath")]),e._v(" "),a("td",[e._v("zipkin.ui.basepath")]),e._v(" "),a("td",[e._v("path prefix placed into the "),a("base"),e._v(' tag in the UI HTML; useful when running behind a reverse proxy. Default "/zipkin"')])])])]),e._v(" "),a("p",[e._v("To map properties to environment variables, change them to upper-underscore case format. For\nexample, if using docker you can set "),a("code",[e._v("ZIPKIN_UI_QUERY_LIMIT=100")]),e._v(" to affect "),a("code",[e._v("$.queryLimit")]),e._v(" in "),a("code",[e._v("/config.json")]),e._v(".")]),e._v(" "),a("h3",{attrs:{id:"trace-archival"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#trace-archival"}},[e._v("#")]),e._v(" Trace archival")]),e._v(" "),a("p",[e._v("Most production Zipkin clusters store traces with a limited TTL. This makes it a bit inconvenient to\nshare a trace, as the link to it will expire after a few days.")]),e._v(" "),a("p",[e._v('The "archive a trace" feature helps with this. Launch a second zipkin server pointing to a storage with a longer\nTTL than the regular one and set the archivePostUrl and archiveUrl UI configs pointing to this second server.\nOnce archivePostUrl is set, a new "Archive Trace" button will appear on the trace view page.')]),e._v(" "),a("h2",{attrs:{id:"storage"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#storage"}},[e._v("#")]),e._v(" Storage")]),e._v(" "),a("h3",{attrs:{id:"in-memory-storage"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#in-memory-storage"}},[e._v("#")]),e._v(" In-Memory Storage")]),e._v(" "),a("p",[e._v("Zipkin's "),a("a",{attrs:{href:"../zipkin/src/main/java/zipkin2/storage/InMemoryStorage.java"}},[e._v("In-Memory Storage")]),e._v(" holds all\ndata in memory, purging older data upon a span limit. It applies when "),a("code",[e._v("STORAGE_TYPE")]),e._v(" is unset or\nset to the value "),a("code",[e._v("mem")]),e._v(".")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[e._v("* `MEM_MAX_SPANS`: Oldest traces (and their spans) will be purged first when this limit is exceeded. Default 500000\n")])])]),a("p",[e._v("Example usage:")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ java -jar zipkin.jar\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("Note: this storage component was primarily developed for testing and as a means to get Zipkin server\nup and running quickly without external dependencies. It is not viable for high work loads. That\nsaid, if you encounter out-of-memory errors, try decreasing "),a("code",[e._v("MEM_MAX_SPANS")]),e._v(" or increasing the heap\nsize (-Xmx).")]),e._v(" "),a("p",[e._v("Exampled of doubling the amount of spans held in memory:")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("MEM_MAX_SPANS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1000000")]),e._v(" java -Xmx1G -jar zipkin.jar\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("h3",{attrs:{id:"cassandra-storage"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cassandra-storage"}},[e._v("#")]),e._v(" Cassandra Storage")]),e._v(" "),a("p",[e._v("Zipkin's "),a("a",{attrs:{href:"../zipkin-storage/cassandra"}},[e._v("Cassandra storage component")]),e._v(" supports Cassandra 3.11.3+\nand applies when "),a("code",[e._v("STORAGE_TYPE")]),e._v(" is set to "),a("code",[e._v("cassandra3")]),e._v(":")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[e._v('* `CASSANDRA_KEYSPACE`: The keyspace to use. Defaults to "zipkin2"\n* `CASSANDRA_CONTACT_POINTS`: Comma separated list of host addresses part of Cassandra cluster. You can also specify a custom port with \'host:port\'. Defaults to localhost on port 9042.\n* `CASSANDRA_LOCAL_DC`: Name of the datacenter that will be considered "local" for load balancing. Defaults to "datacenter1"\n* `CASSANDRA_ENSURE_SCHEMA`: Ensuring cassandra has the latest schema. If enabled tries to execute scripts in the classpath prefixed with `cassandra-schema-cql3`. Defaults to true\n* `CASSANDRA_USERNAME` and `CASSANDRA_PASSWORD`: Cassandra authentication. Will throw an exception on startup if authentication fails. No default\n* `CASSANDRA_USE_SSL`: Requires `javax.net.ssl.trustStore` and `javax.net.ssl.trustStorePassword`, defaults to false.\n')])])]),a("p",[e._v("The following are tuning parameters which may not concern all users:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[e._v("* `CASSANDRA_MAX_CONNECTIONS`: Max pooled connections per datacenter-local host. Defaults to 8\n* `CASSANDRA_INDEX_CACHE_MAX`: Maximum trace index metadata entries to cache. Zero disables caching. Defaults to 100000.\n* `CASSANDRA_INDEX_CACHE_TTL`: How many seconds to cache index metadata about a trace. Defaults to 60.\n* `CASSANDRA_INDEX_FETCH_MULTIPLIER`: How many more index rows to fetch than the user-supplied query limit. Defaults to 3.\n")])])]),a("p",[e._v("Example usage with Cassandra with request logging (TRACE shows query values):")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("STORAGE_TYPE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("cassandra3 java -jar zipkin.jar "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n--logging.level.com.datastax.oss.driver.internal.core.tracker.RequestLogger"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("DEBUG\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("h3",{attrs:{id:"elasticsearch-storage"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#elasticsearch-storage"}},[e._v("#")]),e._v(" Elasticsearch Storage")]),e._v(" "),a("p",[e._v("Zipkin's "),a("a",{attrs:{href:"../zipkin-storage/elasticsearch"}},[e._v("Elasticsearch storage component")]),e._v("\nsupports versions 5-7.x and applies when "),a("code",[e._v("STORAGE_TYPE")]),e._v(" is set to "),a("code",[e._v("elasticsearch")])]),e._v(" "),a("p",[e._v("The following apply when "),a("code",[e._v("STORAGE_TYPE")]),e._v(" is set to "),a("code",[e._v("elasticsearch")]),e._v(":")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[e._v("* `ES_HOSTS`: A comma separated list of elasticsearch base urls to connect to ex. http://host:9200.\n              Defaults to \"http://localhost:9200\".\n* `ES_PIPELINE`: Indicates the ingest pipeline used before spans are indexed. No default.\n* `ES_TIMEOUT`: Controls the connect, read and write socket timeouts (in milliseconds) for\n                Elasticsearch API. Defaults to 10000 (10 seconds)\n* `ES_INDEX`: The index prefix to use when generating daily index names. Defaults to zipkin.\n* `ES_DATE_SEPARATOR`: The date separator to use when generating daily index names. Defaults to '-'.\n* `ES_INDEX_SHARDS`: The number of shards to split the index into. Each shard and its replicas\n                     are assigned to a machine in the cluster. Increasing the number of shards\n                     and machines in the cluster will improve read and write performance. Number\n                     of shards cannot be changed for existing indices, but new daily indices\n                     will pick up changes to the setting. Defaults to 5.\n* `ES_INDEX_REPLICAS`: The number of replica copies of each shard in the index. Each shard and\n                       its replicas are assigned to a machine in the cluster. Increasing the\n                       number of replicas and machines in the cluster will improve read\n                       performance, but not write performance. Number of replicas can be changed\n                       for existing indices. Defaults to 1. It is highly discouraged to set this\n                       to 0 as it would mean a machine failure results in data loss.\n* `ES_ENSURE_TEMPLATES`: Installs Zipkin index templates when missing. Setting this to false can\n                         lead to corrupted data when index templates mismatch expectations. If\n                         you set this to false, you choose to troubleshoot your own data or\n                         migration problems as opposed to relying on the community for this.\n                         Defaults to true.\n* `ES_USERNAME` and `ES_PASSWORD`: Elasticsearch basic authentication, which defaults to empty string.\n                                   Use when X-Pack security (formerly Shield) is in place.\n* `ES_CREDENTIALS_FILE`: The location of a file containing Elasticsearch basic authentication\n                         credentials, as properties. The username property is\n                         `zipkin.storage.elasticsearch.username`, password `zipkin.storage.elasticsearch.password`.\n                         This file is reloaded periodically, using `ES_CREDENTIALS_REFRESH_INTERVAL`\n                         as the interval. This parameter takes precedence over ES_USERNAME and\n                          ES_PASSWORD when specified.\n* `ES_CREDENTIALS_REFRESH_INTERVAL`: Credentials refresh interval in seconds, which defaults to\n                                     1 second. This is the maximum amount of time spans will drop due to stale\n                                     credentials. Any errors reading the credentials file occur in logs at this rate.\n* `ES_HTTP_LOGGING`: When set, controls the volume of HTTP logging of the Elasticsearch API.\n                     Options are BASIC, HEADERS, BODY\n* `ES_SSL_NO_VERIFY`: When true, disables the verification of server's key certificate chain.\n                      This is not appropriate for production. Defaults to false.\n* `ES_TEMPLATE_PRIORITY`: The priority value of the composable index templates. This is only applicable\n                          for ES version 7.8 or above. Must be set, even to 0, to use composable template\n")])])]),a("p",[e._v("Example usage:")]),e._v(" "),a("p",[e._v("To connect normally:")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("STORAGE_TYPE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("elasticsearch "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("ES_HOSTS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("http://myhost:9200 java -jar zipkin.jar\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("To log Elasticsearch API requests:")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("STORAGE_TYPE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("elasticsearch "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("ES_HTTP_LOGGING")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("BASIC java -jar zipkin.jar\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("h4",{attrs:{id:"using-a-custom-key-store-or-trust-store-ssl"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#using-a-custom-key-store-or-trust-store-ssl"}},[e._v("#")]),e._v(" Using a custom Key Store or Trust Store (SSL)")]),e._v(" "),a("p",[e._v("If your Elasticsearch endpoint customized SSL configuration (for example self-signed) certificates,\nyou can use any of the following "),a("a",{attrs:{href:"https://docs.oracle.com/javase/8/docs/technotes/guides/security/jsse/JSSERefGuide.html#T6",target:"_blank",rel:"noopener noreferrer"}},[e._v("subset of JSSE properties"),a("OutboundLink")],1),e._v(" to connect.")]),e._v(" "),a("ul",[a("li",[e._v("javax.net.ssl.keyStore")]),e._v(" "),a("li",[e._v("javax.net.ssl.keyStorePassword")]),e._v(" "),a("li",[e._v("javax.net.ssl.keyStoreType")]),e._v(" "),a("li",[e._v("javax.net.ssl.trustStore")]),e._v(" "),a("li",[e._v("javax.net.ssl.trustStorePassword")]),e._v(" "),a("li",[e._v("javax.net.ssl.trustStoreType")])]),e._v(" "),a("p",[e._v("Usage example:")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("JAVA_OPTS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'-Djavax.net.ssl.keyStore=keystore.p12 -Djavax.net.ssl.keyStorePassword=keypassword -Djavax.net.ssl.keyStoreType=PKCS12 -Djavax.net.ssl.trustStore=truststore.p12 -Djavax.net.ssl.trustStorePassword=trustpassword -Djavax.net.ssl.trustStoreType=PKCS12'")]),e._v("\n$ "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("STORAGE_TYPE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("elasticsearch java "),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$JAVA_OPTS")]),e._v(" -jar zipkin.jar\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("p",[e._v("Under the scenes, these map to properties prefixed "),a("code",[e._v("zipkin.storage.elasticsearch.ssl.")]),e._v(", which affect\nthe Armeria client used to connect to Elasticsearch.")]),e._v(" "),a("p",[e._v("The above properties allow the most common SSL setup to work out of box. If you need more\ncustomization, please make a comment in "),a("a",{attrs:{href:"https://github.com/openzipkin/zipkin/issues/2774",target:"_blank",rel:"noopener noreferrer"}},[e._v("this issue"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("h4",{attrs:{id:"automatic-index-creation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#automatic-index-creation"}},[e._v("#")]),e._v(" Automatic Index Creation")]),e._v(" "),a("p",[e._v("Zipkin will automatically create new indices as needed. Elasticsearch by default "),a("a",{attrs:{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-index_.html#index-creation",target:"_blank",rel:"noopener noreferrer"}},[e._v("allows"),a("OutboundLink")],1),e._v(" automatic creation of said indices, though your local install may have been configured to disallow it. You can verify this in the cluster settings: "),a("code",[e._v("action.auto_create_index: false")]),e._v(".")]),e._v(" "),a("h3",{attrs:{id:"legacy-v1-storage-components"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#legacy-v1-storage-components"}},[e._v("#")]),e._v(" Legacy (v1) storage components")]),e._v(" "),a("p",[e._v('The following components are no longer encouraged, but exist to help aid\ntransition to supported ones. These are indicated as "v1" as they use\ndata layouts based on Zipkin\'s V1 Thrift model, as opposed to the\nsimpler v2 data model currently used.')]),e._v(" "),a("h4",{attrs:{id:"mysql-storage"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysql-storage"}},[e._v("#")]),e._v(" MySQL Storage")]),e._v(" "),a("p",[e._v("Zipkin's "),a("a",{attrs:{href:"../zipkin-storage/mysql-v1"}},[e._v("MySQL component")]),e._v(" is tested against MySQL\n5.7 and applies when "),a("code",[e._v("STORAGE_TYPE")]),e._v(" is set to "),a("code",[e._v("mysql")]),e._v(":")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[e._v('* `MYSQL_DB`: The database to use. Defaults to "zipkin".\n* `MYSQL_USER` and `MYSQL_PASS`: MySQL authentication, which defaults to empty string.\n* `MYSQL_HOST`: Defaults to localhost\n* `MYSQL_TCP_PORT`: Defaults to 3306\n* `MYSQL_MAX_CONNECTIONS`: Maximum concurrent connections, defaults to 10\n* `MYSQL_USE_SSL`: Requires `javax.net.ssl.trustStore` and `javax.net.ssl.trustStorePassword`, defaults to false.\n')])])]),a("p",[e._v("Note: This module is not recommended for production usage. Before using this,\nyou must "),a("a",{attrs:{href:"../zipkin-storage/mysql-v1#applying-the-schema"}},[e._v("apply the schema")]),e._v(".")]),e._v(" "),a("p",[e._v("Alternatively you can use "),a("code",[e._v("MYSQL_JDBC_URL")]),e._v(" and specify the complete JDBC url yourself. Note that the URL constructed by\nusing the separate settings above will also include the following parameters:\n"),a("code",[e._v("?autoReconnect=true&useSSL=false&useUnicode=yes&characterEncoding=UTF-8")]),e._v(". If you specify the JDBC url yourself, add\nthese parameters as well.")]),e._v(" "),a("p",[e._v("Example usage:")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("STORAGE_TYPE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("mysql "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("MYSQL_USER")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("root java -jar zipkin.jar\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("h3",{attrs:{id:"throttled-storage-experimental"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#throttled-storage-experimental"}},[e._v("#")]),e._v(" Throttled Storage (Experimental)")]),e._v(" "),a("p",[e._v("These settings can be used to help tune the rate at which Zipkin flushes data to another, underlying\n"),a("code",[e._v("StorageComponent")]),e._v(" (such as Elasticsearch):")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[e._v("* `STORAGE_THROTTLE_ENABLED`: Enables throttling\n* `STORAGE_THROTTLE_MIN_CONCURRENCY`: Minimum number of Threads to use for writing to storage.\n* `STORAGE_THROTTLE_MAX_CONCURRENCY`: Maximum number of Threads to use for writing to storage.\n* `STORAGE_THROTTLE_MAX_QUEUE_SIZE`: How many messages to buffer while all Threads are writing data before abandoning a message (0 = no buffering).\n")])])]),a("p",[e._v("As this feature is experimental, it is not recommended to run this in production environments.")]),e._v(" "),a("h2",{attrs:{id:"collector-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#collector-2"}},[e._v("#")]),e._v(" Collector")]),e._v(" "),a("h3",{attrs:{id:"http-collector"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#http-collector"}},[e._v("#")]),e._v(" HTTP Collector")]),e._v(" "),a("p",[e._v("The HTTP collector is enabled by default. It accepts spans via "),a("code",[e._v("POST /api/v1/spans")]),e._v(" and "),a("code",[e._v("POST /api/v2/spans")]),e._v(".\nThe HTTP collector supports the following configuration:")]),e._v(" "),a("table",[a("thead",[a("tr",[a("th",[e._v("Property")]),e._v(" "),a("th",[e._v("Environment Variable")]),e._v(" "),a("th",[e._v("Description")])])]),e._v(" "),a("tbody",[a("tr",[a("td",[a("code",[e._v("zipkin.collector.http.enabled")])]),e._v(" "),a("td",[a("code",[e._v("COLLECTOR_HTTP_ENABLED")])]),e._v(" "),a("td",[a("code",[e._v("false")]),e._v(" disables the HTTP collector. Defaults to "),a("code",[e._v("true")]),e._v(".")])])])]),e._v(" "),a("h3",{attrs:{id:"scribe-legacy-collector"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#scribe-legacy-collector"}},[e._v("#")]),e._v(" Scribe (Legacy) Collector")]),e._v(" "),a("p",[e._v("A collector supporting Scribe is enabled when "),a("code",[e._v("COLLECTOR_SCRIBE_ENABLED=true")]),e._v(". New\nsites are discouraged from using this collector as Scribe is an archived\ntechnology.")]),e._v(" "),a("table",[a("thead",[a("tr",[a("th",[e._v("Environment Variable")]),e._v(" "),a("th",[e._v("Property")]),e._v(" "),a("th",[e._v("Description")])])]),e._v(" "),a("tbody",[a("tr",[a("td",[a("code",[e._v("COLLECTOR_PORT")])]),e._v(" "),a("td",[a("code",[e._v("zipkin.collector.scribe.port")])]),e._v(" "),a("td",[e._v("The port to listen for thrift RPC scribe requests. Defaults to 9410")])]),e._v(" "),a("tr",[a("td",[a("code",[e._v("SCRIBE_CATEGORY")])]),e._v(" "),a("td",[a("code",[e._v("zipkin.collector.scribe.category")])]),e._v(" "),a("td",[e._v("Category zipkin spans will be consumed from. Defaults to "),a("code",[e._v("zipkin")])])])])]),e._v(" "),a("h3",{attrs:{id:"activemq-collector"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#activemq-collector"}},[e._v("#")]),e._v(" ActiveMQ Collector")]),e._v(" "),a("p",[e._v("The "),a("a",{attrs:{href:"../zipkin-collector/activemq"}},[e._v("ActiveMQ Collector")]),e._v(" is enabled when "),a("code",[e._v("ACTIVEMQ_URL")]),e._v(" is set to a v5.x broker. The following settings apply in this case.")]),e._v(" "),a("table",[a("thead",[a("tr",[a("th",[e._v("Environment Variable")]),e._v(" "),a("th",[e._v("Property")]),e._v(" "),a("th",[e._v("Description")])])]),e._v(" "),a("tbody",[a("tr",[a("td",[a("code",[e._v("COLLECTOR_ACTIVEMQ_ENABLED")])]),e._v(" "),a("td",[a("code",[e._v("zipkin.collector.activemq.enabled")])]),e._v(" "),a("td",[a("code",[e._v("false")]),e._v(" disables the ActiveMQ collector. Defaults to "),a("code",[e._v("true")]),e._v(".")])]),e._v(" "),a("tr",[a("td",[a("code",[e._v("ACTIVEMQ_URL")])]),e._v(" "),a("td",[a("code",[e._v("zipkin.collector.activemq.url")])]),e._v(" "),a("td",[a("a",{attrs:{href:"https://activemq.apache.org/uri-protocols",target:"_blank",rel:"noopener noreferrer"}},[e._v("Connection URL"),a("OutboundLink")],1),e._v(" to the ActiveMQ broker, ex. "),a("code",[e._v("tcp://localhost:61616")]),e._v(" or "),a("code",[e._v("failover:(tcp://localhost:61616,tcp://remotehost:61616)")])])]),e._v(" "),a("tr",[a("td",[a("code",[e._v("ACTIVEMQ_QUEUE")])]),e._v(" "),a("td",[a("code",[e._v("zipkin.collector.activemq.queue")])]),e._v(" "),a("td",[e._v("Queue from which to collect span messages. Defaults to "),a("code",[e._v("zipkin")])])]),e._v(" "),a("tr",[a("td",[a("code",[e._v("ACTIVEMQ_CLIENT_ID_PREFIX")])]),e._v(" "),a("td",[a("code",[e._v("zipkin.collector.activemq.client-id-prefix")])]),e._v(" "),a("td",[e._v("Client ID prefix for queue consumers. Defaults to "),a("code",[e._v("zipkin")])])]),e._v(" "),a("tr",[a("td",[a("code",[e._v("ACTIVEMQ_CONCURRENCY")])]),e._v(" "),a("td",[a("code",[e._v("zipkin.collector.activemq.concurrency")])]),e._v(" "),a("td",[e._v("Number of concurrent span consumers. Defaults to "),a("code",[e._v("1")])])]),e._v(" "),a("tr",[a("td",[a("code",[e._v("ACTIVEMQ_USERNAME")])]),e._v(" "),a("td",[a("code",[e._v("zipkin.collector.activemq.username")])]),e._v(" "),a("td",[e._v("Optional username to connect to the broker")])]),e._v(" "),a("tr",[a("td",[a("code",[e._v("ACTIVEMQ_PASSWORD")])]),e._v(" "),a("td",[a("code",[e._v("zipkin.collector.activemq.password")])]),e._v(" "),a("td",[e._v("Optional password to connect to the broker")])])])]),e._v(" "),a("p",[e._v("Example usage:")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("ACTIVEMQ_URL")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("tcp://localhost:61616 java -jar zipkin.jar\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("h3",{attrs:{id:"kafka-collector"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#kafka-collector"}},[e._v("#")]),e._v(" Kafka Collector")]),e._v(" "),a("p",[e._v("The Kafka collector is enabled when "),a("code",[e._v("KAFKA_BOOTSTRAP_SERVERS")]),e._v(' is set to\na v0.10+ server. The following settings apply in this case. Some settings\ncorrespond to "New Consumer Configs" in '),a("a",{attrs:{href:"https://kafka.apache.org/documentation/#newconsumerconfigs",target:"_blank",rel:"noopener noreferrer"}},[e._v("Kafka documentation"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("table",[a("thead",[a("tr",[a("th",[e._v("Variable")]),e._v(" "),a("th",[e._v("New Consumer Config")]),e._v(" "),a("th",[e._v("Description")])])]),e._v(" "),a("tbody",[a("tr",[a("td",[a("code",[e._v("COLLECTOR_KAFKA_ENABLED")])]),e._v(" "),a("td",[e._v("N/A")]),e._v(" "),a("td",[a("code",[e._v("false")]),e._v(" disables the Kafka collector. Defaults to "),a("code",[e._v("true")]),e._v(".")])]),e._v(" "),a("tr",[a("td",[a("code",[e._v("KAFKA_BOOTSTRAP_SERVERS")])]),e._v(" "),a("td",[e._v("bootstrap.servers")]),e._v(" "),a("td",[e._v("Comma-separated list of brokers, ex. 127.0.0.1:9092. No default")])]),e._v(" "),a("tr",[a("td",[a("code",[e._v("KAFKA_GROUP_ID")])]),e._v(" "),a("td",[e._v("group.id")]),e._v(" "),a("td",[e._v("The consumer group this process is consuming on behalf of. Defaults to "),a("code",[e._v("zipkin")])])]),e._v(" "),a("tr",[a("td",[a("code",[e._v("KAFKA_TOPIC")])]),e._v(" "),a("td",[e._v("N/A")]),e._v(" "),a("td",[e._v("Comma-separated list of topics that zipkin spans will be consumed from. Defaults to "),a("code",[e._v("zipkin")])])]),e._v(" "),a("tr",[a("td",[a("code",[e._v("KAFKA_STREAMS")])]),e._v(" "),a("td",[e._v("N/A")]),e._v(" "),a("td",[e._v("Count of threads consuming the topic. Defaults to "),a("code",[e._v("1")])])])])]),e._v(" "),a("p",[e._v("Example usage:")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("KAFKA_BOOTSTRAP_SERVERS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("127.0")]),e._v(".0.1:9092 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n    java -jar zipkin.jar\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("h4",{attrs:{id:"other-kafka-consumer-properties"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#other-kafka-consumer-properties"}},[e._v("#")]),e._v(" Other Kafka consumer properties")]),e._v(" "),a("p",[e._v("You may need to set other\n"),a("a",{attrs:{href:"https://kafka.apache.org/documentation/#newconsumerconfigs",target:"_blank",rel:"noopener noreferrer"}},[e._v("Kafka consumer properties"),a("OutboundLink")],1),e._v(", in\naddition to the ones with explicit properties defined by the collector. In this case, you need to\nprefix that property name with "),a("code",[e._v("zipkin.collector.kafka.overrides")]),e._v(" and pass it as a system property\nargument.")]),e._v(" "),a("p",[e._v("For example, to override "),a("code",[e._v("auto.offset.reset")]),e._v(", you can set a system property named\n"),a("code",[e._v("zipkin.collector.kafka.overrides.auto.offset.reset")]),e._v(":")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("KAFKA_BOOTSTRAP_SERVERS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("127.0")]),e._v(".0.1:9092 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n    java -Dzipkin.collector.kafka.overrides.auto.offset.reset"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("latest -jar zipkin.jar\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("h4",{attrs:{id:"detailed-examples"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#detailed-examples"}},[e._v("#")]),e._v(" Detailed examples")]),e._v(" "),a("p",[e._v("Example targeting Kafka running in Docker:")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("export")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("KAFKA_BOOTSTRAP_SERVERS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$(")]),e._v("docker-machine "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("ip")]),e._v(" `docker-machine active`"),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v(")")])]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Run Kafka in the background")]),e._v("\n$ docker run -d -p "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("9092")]),e._v(":9092 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n    --env "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("ADVERTISED_HOST")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$KAFKA_BOOTSTRAP_SERVERS")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n    --env "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("AUTO_CREATE_TOPICS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("true "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n    spotify/kafka\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Start the zipkin server, which reads $KAFKA_BOOTSTRAP_SERVERS")]),e._v("\n$ java -jar zipkin.jar\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br")])]),a("p",[e._v("Multiple bootstrap servers:")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("KAFKA_BOOTSTRAP_SERVERS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("broker1.local:9092,broker2.local:9092 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n    java -jar zipkin.jar\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("p",[e._v("Alternate topic name(s):")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("KAFKA_BOOTSTRAP_SERVERS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("127.0")]),e._v(".0.1:9092 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n    java -Dzipkin.collector.kafka.topic"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("zapkin,zipken -jar zipkin.jar\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("p",[e._v("Specifying bootstrap servers as a system property, instead of an environment variable:")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ java -Dzipkin.collector.kafka.bootstrap-servers"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("127.0")]),e._v(".0.1:9092 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n    -jar zipkin.jar\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("h3",{attrs:{id:"rabbitmq-collector"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rabbitmq-collector"}},[e._v("#")]),e._v(" RabbitMQ collector")]),e._v(" "),a("p",[e._v("The "),a("a",{attrs:{href:"../zipkin-collector/rabbitmq"}},[e._v("RabbitMQ collector")]),e._v(" will be enabled when the "),a("code",[e._v("addresses")]),e._v(" or "),a("code",[e._v("uri")]),e._v(" for the RabbitMQ server(s) is set.")]),e._v(" "),a("p",[e._v("Example usage:")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("RABBIT_ADDRESSES")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("localhost java -jar zipkin.jar\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("h3",{attrs:{id:"grpc-collector-experimental"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#grpc-collector-experimental"}},[e._v("#")]),e._v(" gRPC Collector (Experimental)")]),e._v(" "),a("p",[e._v("You can enable a gRPC span collector endpoint by setting "),a("code",[e._v("COLLECTOR_GRPC_ENABLED=true")]),e._v(". The\n"),a("code",[e._v("zipkin.proto3.SpanService/Report")]),e._v(" endpoint will run on the same port as normal HTTP (9411).")]),e._v(" "),a("p",[e._v("Example usage:")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("COLLECTOR_GRPC_ENABLED")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("true java -jar zipkin.jar\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("As this service is experimental, it is not recommended to run this in production environments.")]),e._v(" "),a("h2",{attrs:{id:"self-tracing"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#self-tracing"}},[e._v("#")]),e._v(" Self-Tracing")]),e._v(" "),a("p",[e._v("Self tracing exists to help troubleshoot performance of the zipkin-server. Production deployments\nwho enable self-tracing should lower the sample rate from 1.0 (100%) to a much smaller rate, like\n0.001 (0.1% or 1 out of 1000).")]),e._v(" "),a("p",[e._v("When "),a("code",[e._v("zipkin.self-tracing.enabled=true")]),e._v(', Zipkin will self-trace calls to the API under the service\nname "zipkin-server".')]),e._v(" "),a("table",[a("thead",[a("tr",[a("th",[e._v("Variable")]),e._v(" "),a("th",[e._v("Property")]),e._v(" "),a("th",[e._v("Description")])])]),e._v(" "),a("tbody",[a("tr",[a("td",[e._v("SELF_TRACING_ENABLED")]),e._v(" "),a("td",[e._v("zipkin.self-tracing.enabled")]),e._v(" "),a("td",[e._v("Set to true to enable self-tracing. Defaults to false")])]),e._v(" "),a("tr",[a("td",[e._v("SELF_TRACING_SAMPLE_RATE")]),e._v(" "),a("td",[e._v("zipkin.self-tracing.sample-rate")]),e._v(" "),a("td",[e._v("Percentage of self-traces to retain, defaults to always sample (1.0).")])]),e._v(" "),a("tr",[a("td",[e._v("SELF_TRACING_FLUSH_INTERVAL")]),e._v(" "),a("td",[e._v("zipkin.self-tracing.flush-interval")]),e._v(" "),a("td",[e._v("Interval in seconds to flush self-tracing data to storage. Defaults to 1")])])])]),e._v(" "),a("h3",{attrs:{id:"_128-bit-trace-ids"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_128-bit-trace-ids"}},[e._v("#")]),e._v(" 128-bit trace IDs")]),e._v(" "),a("p",[e._v("Zipkin supports 64 and 128-bit trace identifiers, typically serialized\nas 16 or 32 character hex strings. By default, spans reported to zipkin\nwith the same trace ID will be considered in the same trace.")]),e._v(" "),a("p",[e._v("For example, "),a("code",[e._v("463ac35c9f6413ad48485a3953bb6124")]),e._v(" is a 128-bit trace ID,\nwhile "),a("code",[e._v("48485a3953bb6124")]),e._v(" is a 64-bit one.")]),e._v(" "),a("p",[e._v("Note: Span (or parent) IDs within a trace are 64-bit regardless of the\nlength or value of their trace ID.")]),e._v(" "),a("h4",{attrs:{id:"migrating-from-64-to-128-bit-trace-ids"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#migrating-from-64-to-128-bit-trace-ids"}},[e._v("#")]),e._v(" Migrating from 64 to 128-bit trace IDs")]),e._v(" "),a("p",[e._v("Unless you only issue 128-bit traces when all applications support them,\nthe process of updating applications from 64 to 128-bit trace IDs results\nin a mixed state. This mixed state is mitigated by the setting\n"),a("code",[e._v("STRICT_TRACE_ID=false")]),e._v(", explained below. Once a migration is complete,\nremove the setting "),a("code",[e._v("STRICT_TRACE_ID=false")]),e._v(" or set it to true.")]),e._v(" "),a("p",[e._v("Here are a few trace IDs the help what happens during this setting.")]),e._v(" "),a("ul",[a("li",[e._v("Trace ID A: 463ac35c9f6413ad48485a3953bb6124")]),e._v(" "),a("li",[e._v("Trace ID B: 48485a3953bb6124")]),e._v(" "),a("li",[e._v("Trace ID C: 463ac35c9f6413adf1a48a8cff464e0e")]),e._v(" "),a("li",[e._v("Trace ID D: 463ac35c9f6413ad")])]),e._v(" "),a("p",[e._v("In a 64-bit environment, trace IDs will look like B or D above. When an\napplication upgrades to 128-bit instrumentation and decides to create a\n128-bit trace, its trace IDs will look like A or C above.")]),e._v(" "),a("p",[e._v("Applications who aren't yet 128-bit capable typically only retain the\nright-most 16 characters of the trace ID. When this happens, the same\ntrace could be reported as trace ID A or trace ID B.")]),e._v(" "),a("p",[e._v("By default, Zipkin will think these are different trace IDs, as they are\ndifferent strings. During a transition from 64-128 bit trace IDs, spans\nwould appear split across two IDs. For example, it might start as trace\nID A, but the next hop might truncate it to trace ID B. This would render\nthe system unusable for applications performing upgrades.")]),e._v(" "),a("p",[e._v("One way to address this problem is to not use 128-bit trace IDs until\nall applications support them. This prevents a mixed scenario at the cost\nof coordination. Another way is to set "),a("code",[e._v("STRICT_TRACE_ID=false")]),e._v(".")]),e._v(" "),a("p",[e._v("When "),a("code",[e._v("STRICT_TRACE_ID=false")]),e._v(", only the right-most 16 of a 32 character\ntrace ID are considered when grouping or retrieving traces. This setting\nshould only be applied when transitioning from 64 to 128-bit trace IDs\nand removed once the transition is complete.")]),e._v(" "),a("p",[e._v("See https://github.com/openzipkin/b3-propagation/issues/6 for the status\nof known open source libraries on 128-bit trace identifiers.")]),e._v(" "),a("p",[e._v("See "),a("code",[e._v("zipkin2.storage.StorageComponent.Builder")]),e._v(" for even more details!")]),e._v(" "),a("h2",{attrs:{id:"tls-ssl"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#tls-ssl"}},[e._v("#")]),e._v(" TLS/SSL")]),e._v(" "),a("p",[e._v("Zipkin-server can be made to run with TLS if needed:")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# assuming you generate the key like this")]),e._v("\nkeytool -genkeypair -alias mysite -keyalg RSA -keysize "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("2048")]),e._v(" -storetype PKCS12 -keystore zipkin.p12 -validity "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("3650")]),e._v("\n\njava -jar zipkin.jar --armeria.ssl.key-store"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("zipkin.p12 --armeria.ssl.key-store-type"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("PKCS12 --armeria.ssl.key-store-password"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("123123")]),e._v(" --armeria.ssl.key-alias"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("mysite  --armeria.ssl.enabled"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("true --armeria.ports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(".port"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("9411")]),e._v(" --armeria.ports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(".protocols"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("https\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br")])]),a("h2",{attrs:{id:"running-with-docker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#running-with-docker"}},[e._v("#")]),e._v(" Running with Docker")]),e._v(" "),a("p",[e._v("Released versions of zipkin-server are published to Docker Hub as "),a("code",[e._v("openzipkin/zipkin")]),e._v(".\nSee "),a("a",{attrs:{href:"https://github.com/openzipkin/docker-zipkin",target:"_blank",rel:"noopener noreferrer"}},[e._v("docker-zipkin"),a("OutboundLink")],1),e._v(" for details.")]),e._v(" "),a("h2",{attrs:{id:"building-locally"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#building-locally"}},[e._v("#")]),e._v(" Building locally")]),e._v(" "),a("p",[e._v("To build and run the server from the currently checked out source, enter the following.")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Build the server and also make its dependencies")]),e._v("\n$ ./mvnw -T1C -q --batch-mode -DskipTests --also-make -pl zipkin-server clean package\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Run the server")]),e._v("\n$ java -jar ./zipkin-server/target/zipkin-server-*exec.jar\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# or Run the slim server")]),e._v("\n$ java -jar ./zipkin-server/target/zipkin-server-*slim.jar\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br")])])])}),[],!1,null,null,null);t.default=r.exports},1114:function(e,t,a){"use strict";a.r(t);var s=a(1),r=Object(s.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h2",{attrs:{id:""}},[a("a",{staticClass:"header-anchor",attrs:{href:"#"}},[e._v("#")]),e._v(" ")]),e._v(" "),a("ul",[a("li",[a("RouterLink",{attrs:{to:"/spring/track/zipkin/info.html"}},[e._v("")])],1),e._v(" "),a("li",[a("RouterLink",{attrs:{to:"/spring/track/zipkin/quick-start.html"}},[e._v("")])],1),e._v(" "),a("li",[a("RouterLink",{attrs:{to:"/spring/track/zipkin/start-env.html"}},[e._v("zipkin")])],1),e._v(" "),a("li",[a("RouterLink",{attrs:{to:"/spring/track/zipkin/demo.html"}},[e._v("")])],1)])])}),[],!1,null,null,null);t.default=r.exports},1115:function(e,t,a){"use strict";a.r(t);var s=a(1),r=Object(s.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"zipkin-server"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#zipkin-server"}},[e._v("#")]),e._v(" zipkin-server")]),e._v(" "),a("p",[e._v("Zipkin Server  Java 1.8+  jar  HTTP POST /api/v2/spans  9411 Zipkin Server  "),a("a",{attrs:{href:"https://github.com/line/armeria",target:"_blank",rel:"noopener noreferrer"}},[e._v("Armeria"),a("OutboundLink")],1),e._v("   Spring Boot  \n Zipkin Server  "),a("a",{attrs:{href:"http://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Spring Boot"),a("OutboundLink")],1),e._v(" ")]),e._v(" "),a("h2",{attrs:{id:""}},[a("a",{staticClass:"header-anchor",attrs:{href:"#"}},[e._v("#")]),e._v(" ")]),e._v(" "),a("p",[e._v(" spring boot  "),a("code",[e._v("zipkin-server")]),e._v(" ")]),e._v(" "),a("h2",{attrs:{id:""}},[a("a",{staticClass:"header-anchor",attrs:{href:"#"}},[e._v("#")]),e._v(" ")]),e._v(" "),a("p",[e._v(" "),a("a",{attrs:{href:"https://search.maven.org/remote_content?g=io.zipkin&a=zipkin-server&v=LATEST&c=exec",target:"_blank",rel:"noopener noreferrer"}},[e._v(" jar "),a("OutboundLink")],1),e._v(" jarZipkin  JRE 8")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("curl")]),e._v(" -sSL https://zipkin.io/quickstart.sh "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("bash")]),e._v(" -s\n$ java -jar zipkin.jar\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("p",[e._v(" http://your_host:9411 ")]),e._v(" "),a("h2",{attrs:{id:""}},[a("a",{staticClass:"header-anchor",attrs:{href:"#"}},[e._v("#")]),e._v(" ")]),e._v(" "),a("p",[e._v("url http://your_host:9411 ")]),e._v(" "),a("ul",[a("li",[e._v("/ - "),a("a",{attrs:{href:"../zipkin-ui"}},[e._v("UI")])]),e._v(" "),a("li",[e._v("/config.json - UI ")]),e._v(" "),a("li",[e._v("/api/v2 - "),a("a",{attrs:{href:"https://zipkin.io/zipkin-api/#/",target:"_blank",rel:"noopener noreferrer"}},[e._v("API"),a("OutboundLink")],1)]),e._v(" "),a("li",[e._v("/health -  200")]),e._v(" "),a("li",[e._v("/info - ")]),e._v(" "),a("li",[e._v("/metrics - ")]),e._v(" "),a("li",[e._v("/prometheus - Prometheus ")])]),e._v(" "),a("p",[a("a",{attrs:{href:"https://zipkin.io/zipkin-api/#/",target:"_blank",rel:"noopener noreferrer"}},[e._v(" /api/v1 API"),a("OutboundLink")],1),e._v("  HTTP API  "),a("code",[e._v("https://zipkin.io/zipkin-api/zipkin-api.yaml")]),e._v(" Swagger UI ")]),e._v(" "),a("h3",{attrs:{id:"cors-"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cors-"}},[e._v("#")]),e._v(" CORS")]),e._v(" "),a("p",[e._v(" "),a("code",[e._v("/api/v2")]),e._v(" ")]),e._v(" "),a("p",[e._v(" "),a("code",[e._v("zipkin.query.allowed-origins")]),e._v(" ")]),e._v(" "),a("p",[e._v(" "),a("code",[e._v("http://foo.bar.com")]),e._v("  CORS ")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("ZIPKIN_QUERY_ALLOWED_ORIGINS=http://foo.bar.com\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v(" "),a("a",{attrs:{href:"#%E9%85%8D%E7%BD%AE"}},[e._v("")]),e._v(" ")]),e._v(" "),a("h3",{attrs:{id:""}},[a("a",{staticClass:"header-anchor",attrs:{href:"#"}},[e._v("#")]),e._v(" ")]),e._v(" "),a("p",[e._v("Zipkin "),a("a",{attrs:{href:"https://zipkin.io/zipkin-api/#/default/get_services",target:"_blank",rel:"noopener noreferrer"}},[e._v("API"),a("OutboundLink")],1),e._v(" \n"),a("code",[e._v("QUERY_LOOKBACK")]),e._v(" 24")]),e._v(" "),a("h2",{attrs:{id:""}},[a("a",{staticClass:"header-anchor",attrs:{href:"#"}},[e._v("#")]),e._v(" ")]),e._v(" "),a("p",[e._v(" zipkin  INFO   "),a("code",[e._v("logging.level.XXX")]),e._v(" ")]),e._v(" "),a("p",[e._v(" zipkin ")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ java -jar zipkin.jar --logging.level.zipkin2"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("DEBUG\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v(" "),a("a",{attrs:{href:"#%E9%85%8D%E7%BD%AE"}},[e._v("")]),e._v(" ")]),e._v(" "),a("h3",{attrs:{id:""}},[a("a",{staticClass:"header-anchor",attrs:{href:"#"}},[e._v("#")]),e._v(" ")]),e._v(" "),a("p",[e._v(" "),a("a",{attrs:{href:"http://docs.spring.io/spring-boot/docs/current/reference/html/howto-logging.html#howto-configure-logback-for-logging",target:"_blank",rel:"noopener noreferrer"}},[e._v("Spring Boot - Logback"),a("OutboundLink")],1),e._v("  "),a("code",[e._v("--logging.exception-conversion-word=%wEx{full}")]),e._v(" ")]),e._v(" "),a("h2",{attrs:{id:"metrics"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#metrics"}},[e._v("#")]),e._v(" Metrics")]),e._v(" "),a("p",[e._v(" "),a("code",[e._v("/metrics")]),e._v("  "),a("code",[e._v("/prometheus")]),e._v(" ")]),e._v(" "),a("h3",{attrs:{id:"-prometheus-"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#-prometheus-"}},[e._v("#")]),e._v("  Prometheus ")]),e._v(" "),a("p",[e._v("Here's an example "),a("code",[e._v("/prometheus")]),e._v(" configuration, using the Prometheus\nexposition [text format version 0.0.4]")]),e._v(" "),a("p",[e._v(" "),a("code",[e._v("/prometheus")]),e._v("  Prometheus exposition"),a("a",{attrs:{href:"https://prometheus.io/docs/instrumenting/exposition_formats/",target:"_blank",rel:"noopener noreferrer"}},[e._v(" 0.0.4"),a("OutboundLink")],1)]),e._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[e._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("job_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'zipkin'")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("scrape_interval")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" 5s\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("metrics_path")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'/prometheus'")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("static_configs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("targets")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'localhost:9411'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("metric_relabel_configs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Response code count")]),e._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("source_labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("__name__"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("regex")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'^status_(\\d+)_(.*)$'")]),e._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("replacement")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'${1}'")]),e._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("target_label")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" status\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("source_labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("__name__"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("regex")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'^status_(\\d+)_(.*)$'")]),e._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("replacement")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'${2}'")]),e._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("target_label")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" path\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("source_labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("__name__"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("regex")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'^status_(\\d+)_(.*)$'")]),e._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("replacement")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'http_requests_total'")]),e._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("target_label")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" __name__\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br"),a("span",{staticClass:"line-number"},[e._v("14")]),a("br"),a("span",{staticClass:"line-number"},[e._v("15")]),a("br"),a("span",{staticClass:"line-number"},[e._v("16")]),a("br"),a("span",{staticClass:"line-number"},[e._v("17")]),a("br"),a("span",{staticClass:"line-number"},[e._v("18")]),a("br"),a("span",{staticClass:"line-number"},[e._v("19")]),a("br")])]),a("h3",{attrs:{id:""}},[a("a",{staticClass:"header-anchor",attrs:{href:"#"}},[e._v("#")]),e._v(" ")]),e._v(" "),a("p",[e._v("Metric  "),a("code",[e._v("/metrics")]),e._v(" ")]),e._v(" "),a("table",[a("thead",[a("tr",[a("th",[e._v("Metric")]),e._v(" "),a("th",[e._v("")])])]),e._v(" "),a("tbody",[a("tr",[a("td",[e._v("counter.zipkin_collector.messages.$transport")]),e._v(" "),a("td",[e._v("")])]),e._v(" "),a("tr",[a("td",[e._v("counter.zipkin_collector.messages_dropped.$transport")]),e._v(" "),a("td",[e._v("")])]),e._v(" "),a("tr",[a("td",[e._v("counter.zipkin_collector.bytes.$transport")]),e._v(" "),a("td",[e._v("")])]),e._v(" "),a("tr",[a("td",[e._v("counter.zipkin_collector.spans.$transport")]),e._v(" "),a("td",[e._v("")])]),e._v(" "),a("tr",[a("td",[e._v("counter.zipkin_collector.spans_dropped.$transport")]),e._v(" "),a("td",[e._v("")])]),e._v(" "),a("tr",[a("td",[e._v("gauge.zipkin_collector.message_spans.$transport")]),e._v(" "),a("td",[e._v("")])]),e._v(" "),a("tr",[a("td",[e._v("gauge.zipkin_collector.message_bytes.$transport")]),e._v(" "),a("td",[e._v("")])])])]),e._v(" "),a("h2",{attrs:{id:""}},[a("a",{staticClass:"header-anchor",attrs:{href:"#"}},[e._v("#")]),e._v(" ")]),e._v(" "),a("p",[e._v(" ENV  "),a("code",[e._v("STORAGE_TYPE=cassandra3")]),e._v("  Docker ")]),e._v(" "),a("p",[e._v(" Zipkin ")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("QUERY_PORT")]),e._v(": HTTP API  Web UI  "),a("code",[e._v("9411")])]),e._v(" "),a("li",[a("code",[e._v("QUERY_ENABLED")]),e._v(":  "),a("code",[e._v("false")]),e._v("  '/api/v2'  UI  UI  API ,  "),a("code",[e._v("SEARCH_ENABLED")]),e._v("  "),a("code",[e._v("false")])]),e._v(" "),a("li",[a("code",[e._v("SEARCH_ENABLED")]),e._v(": "),a("code",[e._v("false")]),e._v("  API  UI  ID  ID  true")]),e._v(" "),a("li",[a("code",[e._v("QUERY_TIMEOUT")]),e._v(":  "),a("code",[e._v("100ms")]),e._v("  "),a("code",[e._v("0")]),e._v("  "),a("code",[e._v("11s")]),e._v(" ")]),e._v(" "),a("li",[a("code",[e._v("QUERY_LOG_LEVEL")]),e._v(":  "),a("code",[e._v("INFO")])]),e._v(" "),a("li",[a("code",[e._v("QUERY_NAMES_MAX_AGE")]),e._v(":  zipkin-server  UI  300 ")]),e._v(" "),a("li",[a("code",[e._v("QUERY_LOOKBACK")]),e._v(":  endTs  24 ")]),e._v(" "),a("li",[a("code",[e._v("STORAGE_TYPE")]),e._v(": SpanStore : "),a("code",[e._v("mem")]),e._v(", "),a("code",[e._v("mysql")]),e._v(", "),a("code",[e._v("cassandra3")]),e._v(", "),a("code",[e._v("elasticsearch")]),e._v(" ")]),e._v(" "),a("li",[a("code",[e._v("COLLECTOR_SAMPLE_RATE")]),e._v(": 1.0")]),e._v(" "),a("li",[a("code",[e._v("AUTOCOMPLETE_KEYS")]),e._v(":  "),a("code",[e._v("/api/v2/autocompleteTags")]),e._v('  "instance_id,user_id,env"')]),e._v(" "),a("li",[a("code",[e._v("AUTOCOMPLETE_TTL")]),e._v(": / 36000001 ")])]),e._v(" "),a("h3",{attrs:{id:""}},[a("a",{staticClass:"header-anchor",attrs:{href:"#"}},[e._v("#")]),e._v(" ")]),e._v(" "),a("p",[e._v(" Spring Boot  "),a("a",{attrs:{href:"https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-external-config.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Spring Boot"),a("OutboundLink")],1),e._v(" ")]),e._v(" "),a("p",[e._v(" yaml  ENV  Spring  "),a("code",[e._v("spring.config.name=zipkin-server")]),e._v("  Spring Boot  "),a("code",[e._v("zipkin-server.properties")]),e._v("  yaml ")]),e._v(" "),a("p",[e._v(" ENV  "),a("a",{attrs:{href:"https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-external-config.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Spring Boot "),a("OutboundLink")],1),e._v("  "),a("a",{attrs:{href:"https://stackoverflow.com/questions/tagged/spring-boot",target:"_blank",rel:"noopener noreferrer"}},[e._v(""),a("OutboundLink")],1),e._v("  Spring  Zipkin ")]),e._v(" "),a("h2",{attrs:{id:"ui"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ui"}},[e._v("#")]),e._v(" UI")]),e._v(" "),a("p",[e._v("Zipkin  Web UI exec jar  9411 ")]),e._v(" "),a("p",[e._v(" UI  "),a("code",[e._v("/config.json")]),e._v(" ")]),e._v(" "),a("table",[a("thead",[a("tr",[a("th",[e._v("")]),e._v(" "),a("th",[e._v("")]),e._v(" "),a("th",[e._v("")])])]),e._v(" "),a("tbody",[a("tr",[a("td",[e._v("environment")]),e._v(" "),a("td",[e._v("zipkin.ui.environment")]),e._v(" "),a("td",[e._v("")])]),e._v(" "),a("tr",[a("td",[e._v("defaultLookback")]),e._v(" "),a("td",[e._v("zipkin.ui.default-lookback")]),e._v(" "),a("td",[e._v(" UI  900000 15 ")])]),e._v(" "),a("tr",[a("td",[e._v("searchEnabled")]),e._v(" "),a("td",[e._v("zipkin.ui.search-enabled")]),e._v(" "),a("td",[e._v(" Discover ")])]),e._v(" "),a("tr",[a("td",[e._v("queryLimit")]),e._v(" "),a("td",[e._v("zipkin.ui.query-limit")]),e._v(" "),a("td",[e._v(" track  10")])]),e._v(" "),a("tr",[a("td",[e._v("instrumented")]),e._v(" "),a("td",[e._v("zipkin.ui.instrumented")]),e._v(" "),a("td",[e._v(" Zipkin UI , "),a("code",[e._v("http:\\/\\/example.com\\/.*")]),e._v("  ("),a("code",[e._v(".*")]),e._v(") ")])]),e._v(" "),a("tr",[a("td",[e._v("logsUrl")]),e._v(" "),a("td",[e._v("zipkin.ui.logs-url")]),e._v(" "),a("td",[e._v(" url  URL  {traceId}  traceId")])]),e._v(" "),a("tr",[a("td",[e._v("supportUrl")]),e._v(" "),a("td",[e._v("zipkin.ui.support-url")]),e._v(" "),a("td",[e._v(" URL URL ")])]),e._v(" "),a("tr",[a("td",[e._v("archivePostUrl")]),e._v(" "),a("td",[e._v("zipkin.ui.archive-post-url")]),e._v(" "),a("td",[e._v(" Zipkin v2 json  URL "),a("code",[e._v("https://longterm/api/v2/spans")]),e._v(" ")])]),e._v(" "),a("tr",[a("td",[e._v("archiveUrl")]),e._v(" "),a("td",[e._v("zipkin.ui.archive-url")]),e._v(" "),a("td",[e._v(" Web  URL{traceId} "),a("code",[e._v("https://longterm/zipkin/trace/{traceId}")]),e._v(" archivePostUrl.")])]),e._v(" "),a("tr",[a("td",[e._v("dependency.enabled")]),e._v(" "),a("td",[e._v("zipkin.ui.dependency.enabled")]),e._v(" "),a("td",[e._v("UI .  true")])]),e._v(" "),a("tr",[a("td",[e._v("dependency.lowErrorRate")]),e._v(" "),a("td",[e._v("zipkin.ui.dependency.low-error-rate")]),e._v(" "),a("td",[e._v(" 0.5 (50%)  >1 ")])]),e._v(" "),a("tr",[a("td",[e._v("dependency.highErrorRate")]),e._v(" "),a("td",[e._v("zipkin.ui.dependency.high-error-rate")]),e._v(" "),a("td",[e._v(" 0.75 (75%)  >1 ")])]),e._v(" "),a("tr",[a("td",[e._v("basePath")]),e._v(" "),a("td",[e._v("zipkin.ui.basepath")]),e._v(" "),a("td",[e._v(" UI HTML  "),a("code",[e._v("/zipkin")])])])])]),e._v(" "),a("p",[e._v(" docker ZIPKIN_UI_QUERY_LIMIT=100  "),a("code",[e._v("$.queryLimit")]),e._v("  "),a("code",[e._v("/config.json")])]),e._v(" "),a("h3",{attrs:{id:""}},[a("a",{staticClass:"header-anchor",attrs:{href:"#"}},[e._v("#")]),e._v(" ")]),e._v(" "),a("p",[e._v(" Zipkin  TTL ")]),e._v(" "),a("p",[e._v('""  zipkin  TTL  archivePostUrl  archiveUrl UI  archivePostUrl  "Archive Trace" ')]),e._v(" "),a("h2",{attrs:{id:""}},[a("a",{staticClass:"header-anchor",attrs:{href:"#"}},[e._v("#")]),e._v(" ")]),e._v(" "),a("h3",{attrs:{id:""}},[a("a",{staticClass:"header-anchor",attrs:{href:"#"}},[e._v("#")]),e._v(" ")]),e._v(" "),a("p",[e._v("Zipkin  "),a("a",{attrs:{href:"../zipkin/src/main/java/zipkin2/storage/InMemoryStorage.java"}},[e._v("")]),e._v("  "),a("code",[e._v("STORAGE_TYPE")]),e._v("  mem")]),e._v(" "),a("blockquote",[a("ul",[a("li",[a("code",[e._v("MEM_MAX_SPANS")]),e._v(":  500000")])])]),e._v(" "),a("p",[e._v("")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ java -jar zipkin.jar\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("div",{staticClass:"custom-block danger"},[a("p",{staticClass:"custom-block-title"},[e._v("")]),e._v(" "),a("p",[e._v(" Zipkin  MEM_MAX_SPANS  (-Xmx) ")]),e._v(" "),a("p",[e._v("")]),e._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("$ "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("MEM_MAX_SPANS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1000000")]),e._v(" java -Xmx1G -jar zipkin.jar\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])])]),e._v(" "),a("h3",{attrs:{id:"cassandra-"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cassandra-"}},[e._v("#")]),e._v(" Cassandra ")]),e._v(" "),a("p",[e._v("Zipkin  Cassandra  3.11.3+ ")]),e._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[e._v("Cassandra ")]),e._v(" "),a("p",[a("strong",[e._v(" "),a("code",[e._v("STORAGE_TYPE")]),e._v("  "),a("code",[e._v("cassandra3")]),e._v(" ")])]),e._v(" "),a("p",[a("code",[e._v("CASSANDRA_KEYSPACE")]),e._v(':  "zipkin2"\n'),a("code",[e._v("CASSANDRA_CONTACT_POINTS")]),e._v(":  Cassandra  "),a("code",[e._v("host:port")]),e._v("  9042 \n"),a("code",[e._v("CASSANDRA_LOCAL_DC")]),e._v(":  local  datacenter1\n"),a("code",[e._v("CASSANDRA_ENSURE_SCHEMA")]),e._v(":  cassandra  "),a("code",[e._v("cassandra-schema-cql3")]),e._v(" .  true\n"),a("code",[e._v("CASSANDRA_USERNAME")]),e._v("Cassandra \n"),a("code",[e._v("CASSANDRA_PASSWORD")]),e._v(": Cassandra \n"),a("code",[e._v("CASSANDRA_USE_SSL")]),e._v(":  "),a("code",[e._v("javax.net.ssl.trustStore")]),e._v("  "),a("code",[e._v("javax.net.ssl.trustStorePassword")]),e._v(",  false.")]),e._v(" "),a("p",[a("strong",[e._v("")])]),e._v(" "),a("ul",[a("li",[a("code",[e._v("CASSANDRA_MAX_CONNECTIONS")]),e._v(": 8")]),e._v(" "),a("li",[a("code",[e._v("CASSANDRA_INDEX_CACHE_MAX")]),e._v(": 100000")]),e._v(" "),a("li",[a("code",[e._v("CASSANDRA_INDEX_CACHE_TTL")]),e._v(": 60")]),e._v(" "),a("li",[a("code",[e._v("CASSANDRA_INDEX_FETCH_MULTIPLIER")]),e._v(": 3")])])]),e._v(" "),a("p",[e._v(" Cassandra TRACE ")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("STORAGE_TYPE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("cassandra3 java -jar zipkin.jar "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n--logging.level.com.datastax.oss.driver.internal.core.tracker.RequestLogger"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("DEBUG\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("h3",{attrs:{id:"elasticsearch-"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#elasticsearch-"}},[e._v("#")]),e._v(" Elasticsearch ")]),e._v(" "),a("p",[e._v("Zipkin  Elasticsearch  5-7.x ")]),e._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[e._v("Elasticsearch ")]),e._v(" "),a("h2",{attrs:{id:"-storage-type--elasticsearch--"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#-storage-type--elasticsearch--"}},[e._v("#")]),e._v(" "),a("strong",[e._v(" "),a("code",[e._v("STORAGE_TYPE")]),e._v("  "),a("code",[e._v("elasticsearch")]),e._v(" ")])]),e._v(" "),a("ul",[a("li",[a("code",[e._v("ES_HOSTS")]),e._v(':  elasticsearch  url  "http://localhost:9200"')]),e._v(" "),a("li",[a("code",[e._v("ES_PIPELINE")]),e._v(": ")]),e._v(" "),a("li",[a("code",[e._v("ES_TIMEOUT")]),e._v(":  Elasticsearch API  10000 (10)")]),e._v(" "),a("li",[a("code",[e._v("ES_INDEX")]),e._v(":  zipkin.")]),e._v(" "),a("li",[a("code",[e._v("ES_DATE_SEPARATOR")]),e._v(":  '-' .")]),e._v(" "),a("li",[a("code",[e._v("ES_INDEX_SHARDS")]),e._v(":  5")]),e._v(" "),a("li",[a("code",[e._v("ES_INDEX_REPLICAS")]),e._v(":  1  0 ")]),e._v(" "),a("li",[a("code",[e._v("ES_ENSURE_TEMPLATES")]),e._v(": Zipkin false  true true")]),e._v(" "),a("li",[a("code",[e._v("ES_USERNAME")]),e._v(" and "),a("code",[e._v("ES_PASSWORD")]),e._v(": ElasticsearchX-PackShield")]),e._v(" "),a("li",[a("code",[e._v("ES_CREDENTIALS_FILE")]),e._v(": ES ,  ES_USERNAME  ES_PASSWORD \n"),a("ul",[a("li",[a("code",[e._v("zipkin.storage.elasticsearch.username")]),e._v("")]),e._v(" "),a("li",[a("code",[e._v("zipkin.storage.elasticsearch.password")]),e._v("")])])]),e._v(" "),a("li",[a("code",[e._v("ES_CREDENTIALS_REFRESH_INTERVAL")]),e._v(":  "),a("code",[e._v("ES_CREDENTIALS_FILE")]),e._v(" 1")]),e._v(" "),a("li",[a("code",[e._v("ES_HTTP_LOGGING")]),e._v(":  Elasticsearch API  HTTP Options are BASIC, HEADERS, BODY")]),e._v(" "),a("li",[a("code",[e._v("ES_SSL_NO_VERIFY")]),e._v(": truefalse")]),e._v(" "),a("li",[a("code",[e._v("ES_TEMPLATE_PRIORITY")]),e._v(": ES 7.80")])])]),e._v(" "),a("p",[e._v("")]),e._v(" "),a("p",[e._v(" ES :")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("STORAGE_TYPE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("elasticsearch "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("ES_HOSTS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("http://myhost:9200 java -jar zipkin.jar\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v(" ES http :")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("STORAGE_TYPE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("elasticsearch "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("ES_HTTP_LOGGING")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("BASIC java -jar zipkin.jar\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("h4",{attrs:{id:"-ssl"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#-ssl"}},[e._v("#")]),e._v("  (SSL)")]),e._v(" "),a("p",[e._v(" Elasticsearch  SSL  "),a("a",{attrs:{href:"https://docs.oracle.com/javase/8/docs/technotes/guides/security/jsse/JSSERefGuide.html#T6",target:"_blank",rel:"noopener noreferrer"}},[e._v("JSSE "),a("OutboundLink")],1),e._v(" ")]),e._v(" "),a("ul",[a("li",[e._v("javax.net.ssl.keyStore")]),e._v(" "),a("li",[e._v("javax.net.ssl.keyStorePassword")]),e._v(" "),a("li",[e._v("javax.net.ssl.keyStoreType")]),e._v(" "),a("li",[e._v("javax.net.ssl.trustStore")]),e._v(" "),a("li",[e._v("javax.net.ssl.trustStorePassword")]),e._v(" "),a("li",[e._v("javax.net.ssl.trustStoreType")])]),e._v(" "),a("p",[e._v("")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("JAVA_OPTS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'-Djavax.net.ssl.keyStore=keystore.p12 -Djavax.net.ssl.keyStorePassword=keypassword -Djavax.net.ssl.keyStoreType=PKCS12 -Djavax.net.ssl.trustStore=truststore.p12 -Djavax.net.ssl.trustStorePassword=trustpassword -Djavax.net.ssl.trustStoreType=PKCS12'")]),e._v("\n$ "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("STORAGE_TYPE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("elasticsearch java "),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$JAVA_OPTS")]),e._v(" -jar zipkin.jar\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("p",[e._v(" "),a("code",[e._v("prefixed zipkin.storage.elasticsearch.ssl.")]),e._v(" Elasticsearch  Armeria ")]),e._v(" "),a("p",[e._v(" SSL  "),a("a",{attrs:{href:"https://github.com/openzipkin/zipkin/issues/2774",target:"_blank",rel:"noopener noreferrer"}},[e._v("issue"),a("OutboundLink")],1)]),e._v(" "),a("h4",{attrs:{id:""}},[a("a",{staticClass:"header-anchor",attrs:{href:"#"}},[e._v("#")]),e._v(" ")]),e._v(" "),a("p",[e._v(" Zipkin  ES  Elasticsearch  "),a("a",{attrs:{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-index_.html#index-creation",target:"_blank",rel:"noopener noreferrer"}},[e._v(""),a("OutboundLink")],1),e._v(" , : "),a("code",[e._v("action.auto_create_index: false")]),e._v(".")]),e._v(" "),a("h4",{attrs:{id:"mysql-"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysql-"}},[e._v("#")]),e._v(" MySQL ")]),e._v(" "),a("p",[e._v("Zipkin  MySQL  5.7 \n "),a("code",[e._v("STORAGE_TYPE")]),e._v("  "),a("code",[e._v("mysql")]),e._v(" ")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("MYSQL_DB")]),e._v(': MySQL  "zipkin".')]),e._v(" "),a("li",[a("code",[e._v("MYSQL_USER")]),e._v(" and "),a("code",[e._v("MYSQL_PASS")]),e._v(": MySQL , .")]),e._v(" "),a("li",[a("code",[e._v("MYSQL_HOST")]),e._v(":  localhost")]),e._v(" "),a("li",[a("code",[e._v("MYSQL_TCP_PORT")]),e._v(":  3306")]),e._v(" "),a("li",[a("code",[e._v("MYSQL_MAX_CONNECTIONS")]),e._v(":  MySQL , defaults to 10")]),e._v(" "),a("li",[a("code",[e._v("MYSQL_USE_SSL")]),e._v(":  "),a("code",[e._v("javax.net.ssl.trustStore")]),e._v(" and "),a("code",[e._v("javax.net.ssl.trustStorePassword")]),e._v(",  false.")])]),e._v(" "),a("p",[e._v("")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Barracuda supports compression (In AWS RDS, this must be assigned in a parameter group)")]),e._v("\n$ mysql -uroot -e "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"SET GLOBAL innodb_file_format=Barracuda"')]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v('# This command should work even in RDS, and return "Barracuda"')]),e._v("\n$ mysql -uroot -e "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("\"show global variables like 'innodb_file_format'\"")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# install the schema and indexes")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# sql https://github.com/openzipkin/zipkin/blob/master/zipkin-storage/mysql-v1/src/main/resources/mysql.sql")]),e._v("\n$ mysql -uroot -e "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"create database if not exists zipkin"')]),e._v("\n$ mysql -uroot -Dzipkin "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v(" zipkin-storage/mysql-v1/src/main/resources/mysql.sql\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br")])]),a("p",[e._v(" "),a("code",[e._v("MYSQL_JDBC_URL")]),e._v("  JDBC url URL  "),a("code",[e._v("?autoReconnect=true&useSSL=false&useUnicode=yes&characterEncoding=UTF-8")]),e._v("")]),e._v(" "),a("p",[e._v("")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("STORAGE_TYPE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("mysql "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("MYSQL_USER")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("root java -jar zipkin.jar\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("h3",{attrs:{id:"throttled--"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#throttled--"}},[e._v("#")]),e._v(" Throttled  ()")]),e._v(" "),a("p",[e._v(" Zipkin  "),a("code",[e._v("StorageComponent")]),e._v("  Elasticsearch")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("STORAGE_THROTTLE_ENABLED")]),e._v(": Enables throttling")]),e._v(" "),a("li",[a("code",[e._v("STORAGE_THROTTLE_MIN_CONCURRENCY")]),e._v(": Minimum number of Threads to use for writing to storage.")]),e._v(" "),a("li",[a("code",[e._v("STORAGE_THROTTLE_MAX_CONCURRENCY")]),e._v(": Maximum number of Threads to use for writing to storage.")]),e._v(" "),a("li",[a("code",[e._v("STORAGE_THROTTLE_MAX_QUEUE_SIZE")]),e._v(": How many messages to buffer while all Threads are writing data before abandoning a message (0 = no buffering).")])]),e._v(" "),a("p",[e._v("")]),e._v(" "),a("h2",{attrs:{id:"-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#-2"}},[e._v("#")]),e._v(" ")]),e._v(" "),a("h3",{attrs:{id:"http-"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#http-"}},[e._v("#")]),e._v(" HTTP ")]),e._v(" "),a("p",[e._v("HTTP   "),a("code",[e._v("POST /api/v1/spans")]),e._v(" and "),a("code",[e._v("POST /api/v2/spans")]),e._v(".\nHTTP :")]),e._v(" "),a("table",[a("thead",[a("tr",[a("th",[e._v("")]),e._v(" "),a("th",[e._v("")]),e._v(" "),a("th",[e._v("")])])]),e._v(" "),a("tbody",[a("tr",[a("td",[a("code",[e._v("COLLECTOR_HTTP_ENABLED")])]),e._v(" "),a("td",[a("code",[e._v("zipkin.collector.http.enabled")])]),e._v(" "),a("td",[a("code",[e._v("false")]),e._v("  HTTP  "),a("code",[e._v("true")])])])])]),e._v(" "),a("h3",{attrs:{id:"scribe-legacy-collector"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#scribe-legacy-collector"}},[e._v("#")]),e._v(" Scribe (Legacy) Collector")]),e._v(" "),a("p",[e._v(" Scribe  "),a("code",[e._v("COLLECTOR_SCRIBE_ENABLED=true")]),e._v(" .  Scribe ")]),e._v(" "),a("table",[a("thead",[a("tr",[a("th",[e._v("")]),e._v(" "),a("th",[e._v("")]),e._v(" "),a("th",[e._v("")])])]),e._v(" "),a("tbody",[a("tr",[a("td",[a("code",[e._v("COLLECTOR_PORT")])]),e._v(" "),a("td",[a("code",[e._v("zipkin.collector.scribe.port")])]),e._v(" "),a("td",[e._v(" thrift RPC scribe  9410")])]),e._v(" "),a("tr",[a("td",[a("code",[e._v("SCRIBE_CATEGORY")])]),e._v(" "),a("td",[a("code",[e._v("zipkin.collector.scribe.category")])]),e._v(" "),a("td",[e._v(" zipkin  "),a("code",[e._v("zipkin")])])])])]),e._v(" "),a("h3",{attrs:{id:"activemq-"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#activemq-"}},[e._v("#")]),e._v(" ActiveMQ ")]),e._v(" "),a("p",[e._v("Zipkin  ActiveMQ  v5.x  "),a("code",[e._v("ACTIVEMQ_URL")]),e._v(" ")]),e._v(" "),a("table",[a("thead",[a("tr",[a("th",[e._v("")]),e._v(" "),a("th",[e._v("")]),e._v(" "),a("th",[e._v("")])])]),e._v(" "),a("tbody",[a("tr",[a("td",[a("code",[e._v("COLLECTOR_ACTIVEMQ_ENABLED")])]),e._v(" "),a("td",[a("code",[e._v("zipkin.collector.activemq.enabled")])]),e._v(" "),a("td",[a("code",[e._v("false")]),e._v("  ActiveMQ  "),a("code",[e._v("true")]),e._v(".")])]),e._v(" "),a("tr",[a("td",[a("code",[e._v("ACTIVEMQ_URL")])]),e._v(" "),a("td",[a("code",[e._v("zipkin.collector.activemq.url")])]),e._v(" "),a("td",[a("a",{attrs:{href:"https://activemq.apache.org/uri-protocols",target:"_blank",rel:"noopener noreferrer"}},[e._v("Connection URL"),a("OutboundLink")],1),e._v(" ,  "),a("code",[e._v("tcp://localhost:61616")]),e._v("  "),a("code",[e._v("failover:(tcp://localhost:61616,tcp://remotehost:61616)")])])]),e._v(" "),a("tr",[a("td",[a("code",[e._v("ACTIVEMQ_QUEUE")])]),e._v(" "),a("td",[a("code",[e._v("zipkin.collector.activemq.queue")])]),e._v(" "),a("td",[e._v("  "),a("code",[e._v("zipkin")])])]),e._v(" "),a("tr",[a("td",[a("code",[e._v("ACTIVEMQ_CLIENT_ID_PREFIX")])]),e._v(" "),a("td",[a("code",[e._v("zipkin.collector.activemq.client-id-prefix")])]),e._v(" "),a("td",[e._v("ID "),a("code",[e._v("zipkin")])])]),e._v(" "),a("tr",[a("td",[a("code",[e._v("ACTIVEMQ_CONCURRENCY")])]),e._v(" "),a("td",[a("code",[e._v("zipkin.collector.activemq.concurrency")])]),e._v(" "),a("td",[e._v("  "),a("code",[e._v("1")])])]),e._v(" "),a("tr",[a("td",[a("code",[e._v("ACTIVEMQ_USERNAME")])]),e._v(" "),a("td",[a("code",[e._v("zipkin.collector.activemq.username")])]),e._v(" "),a("td",[e._v("ActiveMQ ")])]),e._v(" "),a("tr",[a("td",[a("code",[e._v("ACTIVEMQ_PASSWORD")])]),e._v(" "),a("td",[a("code",[e._v("zipkin.collector.activemq.password")])]),e._v(" "),a("td",[e._v("ActiveMQ ")])])])]),e._v(" "),a("p",[e._v("")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("ACTIVEMQ_URL")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("tcp://localhost:61616 java -jar zipkin.jar\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("h3",{attrs:{id:"kafka-"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#kafka-"}},[e._v("#")]),e._v(" Kafka ")]),e._v(" "),a("p",[e._v("Zipkin  Kafka  v0.10+  "),a("code",[e._v("KAFKA_BOOTSTRAP_SERVERS")]),e._v(" ")]),e._v(" "),a("p",[e._v(" kafka  "),a("a",{attrs:{href:"https://kafka.apache.org/documentation/#newconsumerconfigs",target:"_blank",rel:"noopener noreferrer"}},[e._v(""),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("table",[a("thead",[a("tr",[a("th",[e._v("")]),e._v(" "),a("th",[e._v("New Consumer Config")]),e._v(" "),a("th",[e._v("")])])]),e._v(" "),a("tbody",[a("tr",[a("td",[a("code",[e._v("COLLECTOR_KAFKA_ENABLED")])]),e._v(" "),a("td",[e._v("N/A")]),e._v(" "),a("td",[a("code",[e._v("false")]),e._v("  Kafka  "),a("code",[e._v("true")]),e._v(".")])]),e._v(" "),a("tr",[a("td",[a("code",[e._v("KAFKA_BOOTSTRAP_SERVERS")])]),e._v(" "),a("td",[e._v("bootstrap.servers")]),e._v(" "),a("td",[e._v(",  127.0.0.1:9092")])]),e._v(" "),a("tr",[a("td",[a("code",[e._v("KAFKA_GROUP_ID")])]),e._v(" "),a("td",[e._v("group.id")]),e._v(" "),a("td",[e._v(" "),a("code",[e._v("zipkin")])])]),e._v(" "),a("tr",[a("td",[a("code",[e._v("KAFKA_TOPIC")])]),e._v(" "),a("td",[e._v("N/A")]),e._v(" "),a("td",[e._v("kafka  topic  "),a("code",[e._v("zipkin")])])]),e._v(" "),a("tr",[a("td",[a("code",[e._v("KAFKA_STREAMS")])]),e._v(" "),a("td",[e._v("N/A")]),e._v(" "),a("td",[e._v("topic   "),a("code",[e._v("1")])])])])]),e._v(" "),a("p",[e._v("")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("KAFKA_BOOTSTRAP_SERVERS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("127.0")]),e._v(".0.1:9092 java -jar zipkin.jar\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("h4",{attrs:{id:"-kafka-"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#-kafka-"}},[e._v("#")]),e._v("  kafka ")]),e._v(" "),a("p",[e._v(" "),a("a",{attrs:{href:"https://kafka.apache.org/documentation/#newconsumerconfigs",target:"_blank",rel:"noopener noreferrer"}},[e._v("Kafka "),a("OutboundLink")],1),e._v(" "),a("code",[e._v("zipkin.collector.kafka.overrides")]),e._v(" \n "),a("code",[e._v("auto.offset.reset")]),e._v(" ,  "),a("code",[e._v("zipkin.collector.kafka.overrides.auto.offset.reset")]),e._v(" :")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("KAFKA_BOOTSTRAP_SERVERS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("127.0")]),e._v(".0.1:9092 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n    java -Dzipkin.collector.kafka.overrides.auto.offset.reset"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("latest -jar zipkin.jar\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("h4",{attrs:{id:""}},[a("a",{staticClass:"header-anchor",attrs:{href:"#"}},[e._v("#")]),e._v(" ")]),e._v(" "),a("p",[e._v(" Docker  Kafka ")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("export")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("KAFKA_BOOTSTRAP_SERVERS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$(")]),e._v("docker-machine "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("ip")]),e._v(" `docker-machine active`"),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v(")")])]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#  kafka")]),e._v("\n$ docker run -d -p "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("9092")]),e._v(":9092 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n    --env "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("ADVERTISED_HOST")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$KAFKA_BOOTSTRAP_SERVERS")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n    --env "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("AUTO_CREATE_TOPICS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("true "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n    spotify/kafka\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#  $KAFKA_BOOTSTRAP_SERVERS  zipkin ")]),e._v("\n$ java -jar zipkin.jar\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br")])]),a("p",[e._v(" bootstrap servers :")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("KAFKA_BOOTSTRAP_SERVERS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("broker1.local:9092,broker2.local:9092 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n    java -jar zipkin.jar\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("p",[e._v(" topic :")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("KAFKA_BOOTSTRAP_SERVERS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("127.0")]),e._v(".0.1:9092 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n    java -Dzipkin.collector.kafka.topic"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("zapkin,zipken -jar zipkin.jar\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("p",[e._v(" bootstrap servers :")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ java -Dzipkin.collector.kafka.bootstrap-servers"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("127.0")]),e._v(".0.1:9092 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n    -jar zipkin.jar\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("h3",{attrs:{id:"rabbitmq-"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rabbitmq-"}},[e._v("#")]),e._v(" RabbitMQ ")]),e._v(" "),a("p",[e._v(" "),a("code",[e._v("addresses")]),e._v("  "),a("code",[e._v("uri")]),e._v("  "),a("a",{attrs:{href:"../zipkin-collector/rabbitmq"}},[e._v("RabbitMQ ")]),e._v(" ")]),e._v(" "),a("p",[e._v("")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("RABBIT_ADDRESSES")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("localhost java -jar zipkin.jar\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("h3",{attrs:{id:"grpc--"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#grpc--"}},[e._v("#")]),e._v(" gRPC  ()")]),e._v(" "),a("p",[e._v(" "),a("code",[e._v("COLLECTOR_GRPC_ENABLED=true")]),e._v("  gRPC  "),a("code",[e._v("zipkin.proto3.SpanService/Report")]),e._v("  http ")]),e._v(" "),a("p",[e._v("")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("COLLECTOR_GRPC_ENABLED")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("true java -jar zipkin.jar\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("")]),e._v(" "),a("h2",{attrs:{id:""}},[a("a",{staticClass:"header-anchor",attrs:{href:"#"}},[e._v("#")]),e._v(" ")]),e._v(" "),a("p",[e._v(" zipkin  1.0 (100%)  0.0010.1% ")]),e._v(" "),a("p",[e._v(" "),a("code",[e._v("zipkin.self-tracing.enabled=true")]),e._v(', Zipkin  "zipkin-server"  API ')]),e._v(" "),a("table",[a("thead",[a("tr",[a("th",[e._v("")]),e._v(" "),a("th",[e._v("")]),e._v(" "),a("th",[e._v("")])])]),e._v(" "),a("tbody",[a("tr",[a("td",[e._v("SELF_TRACING_ENABLED")]),e._v(" "),a("td",[e._v("zipkin.self-tracing.enabled")]),e._v(" "),a("td",[e._v(" true  false")])]),e._v(" "),a("tr",[a("td",[e._v("SELF_TRACING_SAMPLE_RATE")]),e._v(" "),a("td",[e._v("zipkin.self-tracing.sample-rate")]),e._v(" "),a("td",[e._v(" (1.0)")])]),e._v(" "),a("tr",[a("td",[e._v("SELF_TRACING_FLUSH_INTERVAL")]),e._v(" "),a("td",[e._v("zipkin.self-tracing.flush-interval")]),e._v(" "),a("td",[e._v(" 1")])])])]),e._v(" "),a("h3",{attrs:{id:"_128--id"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_128--id"}},[e._v("#")]),e._v(" 128  ID")]),e._v(" "),a("p",[e._v("Zipkin  64  128  16  32  zipkin  ID ")]),e._v(" "),a("p",[e._v(" "),a("code",[e._v("463ac35c9f6413ad48485a3953bb6124")]),e._v("  128  ID "),a("code",[e._v("48485a3953bb6124")]),e._v("  64 ")]),e._v(" "),a("p",[e._v("ID  64  ID ")]),e._v(" "),a("h4",{attrs:{id:"-64--128--id"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#-64--128--id"}},[e._v("#")]),e._v("  64  128  ID")]),e._v(" "),a("p",[e._v(" 128  64  ID  128  ID  "),a("code",[e._v("STRICT_TRACE_ID=false")]),e._v("  "),a("code",[e._v("STRICT_TRACE_ID=false")]),e._v("  true")]),e._v(" "),a("p",[e._v("ID")]),e._v(" "),a("ul",[a("li",[e._v("Trace ID A: 463ac35c9f6413ad48485a3953bb6124")]),e._v(" "),a("li",[e._v("Trace ID B: 48485a3953bb6124")]),e._v(" "),a("li",[e._v("Trace ID C: 463ac35c9f6413adf1a48a8cff464e0e")]),e._v(" "),a("li",[e._v("Trace ID D: 463ac35c9f6413ad")])]),e._v(" "),a("p",[e._v(" 64  ID  B  D 128  128  ID  A  C")]),e._v(" "),a("p",[e._v(" 128  ID  16  ID A  ID B")]),e._v(" "),a("p",[e._v("Zipkin  ID 64  128  ID  ID  ID A  ID B")]),e._v(" "),a("p",[e._v(" 128  ID "),a("code",[e._v("STRICT_TRACE_ID=false")])]),e._v(" "),a("p",[e._v(" "),a("code",[e._v("STRICT_TRACE_ID=false")]),e._v("  32  ID  16  64  ID  128  ID ")]),e._v(" "),a("p",[e._v(" "),a("a",{attrs:{href:"https://github.com/openzipkin/b3-propagation/issues/6",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://github.com/openzipkin/b3-propagation/issues/6"),a("OutboundLink")],1),e._v("  128 ")]),e._v(" "),a("p",[e._v(" "),a("code",[e._v("zipkin2.storage.StorageComponent.Builder")]),e._v(" ")]),e._v(" "),a("h2",{attrs:{id:"tls-ssl"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#tls-ssl"}},[e._v("#")]),e._v(" TLS/SSL")]),e._v(" "),a("p",[e._v(" Zipkin-server  TLS ")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# assuming you generate the key like this")]),e._v("\nkeytool -genkeypair -alias mysite -keyalg RSA -keysize "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("2048")]),e._v(" -storetype PKCS12 -keystore zipkin.p12 -validity "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("3650")]),e._v("\n\njava -jar zipkin.jar --armeria.ssl.key-store"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("zipkin.p12 --armeria.ssl.key-store-type"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("PKCS12 --armeria.ssl.key-store-password"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("123123")]),e._v(" --armeria.ssl.key-alias"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("mysite  --armeria.ssl.enabled"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("true --armeria.ports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(".port"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("9411")]),e._v(" --armeria.ports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(".protocols"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("https\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br")])]),a("h2",{attrs:{id:"-docker-"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#-docker-"}},[e._v("#")]),e._v("  Docker ")]),e._v(" "),a("p",[e._v("zipkin-server  "),a("code",[e._v("openzipkin/zipkin")]),e._v("  "),a("a",{attrs:{href:"https://hub.docker.com/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker Hub"),a("OutboundLink")],1),e._v("  "),a("a",{attrs:{href:"https://github.com/openzipkin/docker-zipkin",target:"_blank",rel:"noopener noreferrer"}},[e._v("docker-zipkin"),a("OutboundLink")],1),e._v(" ")]),e._v(" "),a("h2",{attrs:{id:""}},[a("a",{staticClass:"header-anchor",attrs:{href:"#"}},[e._v("#")]),e._v(" ")]),e._v(" "),a("p",[e._v("")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Build the server and also make its dependencies")]),e._v("\n$ ./mvnw -T1C -q --batch-mode -DskipTests --also-make -pl zipkin-server clean package\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Run the server")]),e._v("\n$ java -jar ./zipkin-server/target/zipkin-server-*exec.jar\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# or Run the slim server")]),e._v("\n$ java -jar ./zipkin-server/target/zipkin-server-*slim.jar\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br")])])])}),[],!1,null,null,null);t.default=r.exports}}]);